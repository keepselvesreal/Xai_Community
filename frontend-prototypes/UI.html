<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI 완전 UI 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* 사이드바 */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }
        
        .sidebar-title {
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-section-title {
            padding: 0 20px 10px;
            font-size: 0.8em;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #374151;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: #f3f4f6;
        }
        
        .nav-item.active {
            background: #eff6ff;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }
        
        .nav-icon {
            margin-right: 12px;
            font-size: 1.1em;
        }
        
        /* 메인 콘텐츠 */
        .main-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .content-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .page-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #1f2937;
        }
        
        .page-subtitle {
            color: #6b7280;
            margin-top: 5px;
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }
        
        .auth-user {
            padding: 8px 16px;
            background: #f0f9ff;
            color: #0369a1;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .btn-logout {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .content-body {
            padding: 30px;
        }
        
        /* 페이지별 스타일 */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* 대시보드 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }
        
        .stat-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-title {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #1f2937;
        }
        
        /* 인증 폼 */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #e5e7eb;
        }
        
        .auth-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1f2937;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #6b7280;
        }
        
        .auth-switch a {
            color: #2563eb;
            text-decoration: none;
        }
        
        /* 게시글 */
        .posts-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn-new-post {
            padding: 10px 20px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .posts-filters {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }
        
        .filters-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 0.8em;
            font-weight: 600;
            color: #6b7280;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .posts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .post-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .post-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.8em;
            color: #6b7280;
        }
        
        .post-type {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .post-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .post-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #6b7280;
        }
        
        /* 게시글 상세 */
        .post-detail {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .post-detail-header {
            padding: 25px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .post-detail-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .post-detail-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 20px;
        }
        
        .post-reactions {
            display: flex;
            gap: 10px;
        }
        
        .reaction-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reaction-btn:hover {
            background: #f3f4f6;
        }
        
        .reaction-btn.active {
            background: #eff6ff;
            border-color: #2563eb;
            color: #2563eb;
        }
        
        .post-content {
            padding: 25px;
            line-height: 1.7;
            color: #374151;
        }
        
        /* 댓글 */
        .comments-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
        }
        
        .comments-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .comment-form {
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .comment-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
        }
        
        .comment-actions {
            display: flex;
            justify-content: end;
            margin-top: 10px;
        }
        
        .btn-comment {
            padding: 8px 16px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .comments-list {
            padding: 20px 25px;
        }
        
        .no-comments {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 40px 20px;
        }
        
        .comment-item {
            padding: 15px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .comment-item:last-child {
            border-bottom: none;
        }
        
        .comment-author {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .comment-content {
            color: #374151;
            margin-bottom: 10px;
        }
        
        .comment-meta {
            display: flex;
            gap: 15px;
            font-size: 0.8em;
            color: #6b7280;
        }
        
        /* 답글 폼 스타일 */
        .reply-form {
            margin-top: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .reply-textarea {
            width: 100%;
            min-height: 60px;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.9em;
        }
        
        .reply-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 10px;
        }
        
        .btn-reply-submit {
            padding: 6px 12px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .btn-reply-submit:hover {
            background: #047857;
        }
        
        .btn-reply-cancel {
            padding: 6px 12px;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .btn-reply-cancel:hover {
            background: #4b5563;
        }
        
        /* 답글 표시 스타일 */
        .replies-container {
            margin-top: 15px;
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid #e5e7eb;
        }
        
        .reply-item {
            padding: 10px 0;
            border-bottom: 1px solid #f9fafb;
        }
        
        .reply-item:last-child {
            border-bottom: none;
        }
        
        .reply-author {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .reply-content {
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        /* 파일 업로드 영역 스타일 */
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8fafc;
        }
        
        .file-upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-upload-area.dragover {
            border-color: #3b82f6;
            background: #dbeafe;
            transform: scale(1.02);
        }
        
        .file-upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .file-upload-icon {
            font-size: 2em;
            opacity: 0.6;
        }
        
        .file-upload-text p {
            margin: 0;
            font-size: 0.95em;
        }
        
        .file-upload-hint {
            color: #6b7280;
            font-size: 0.85em !important;
        }
        
        .uploaded-files {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-preview {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #e5e7eb;
        }
        
        .file-details {
            display: flex;
            flex-direction: column;
        }
        
        .file-name {
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .file-size {
            color: #6b7280;
            font-size: 0.8em;
        }
        
        .file-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .file-remove:hover {
            background: #dc2626;
        }
        
        /* 게시글 첨부 파일 표시 스타일 */
        .post-attachments {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .attachments-header {
            margin-bottom: 15px;
        }
        
        .attachments-header h4 {
            margin: 0;
            color: #374151;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .attachments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .attachment-item {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .attachment-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .attachment-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .attachment-info {
            padding: 10px;
        }
        
        .attachment-name {
            font-size: 0.9em;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
            word-break: break-word;
        }
        
        .attachment-size {
            font-size: 0.8em;
            color: #6b7280;
        }
        
        /* 이미지 모달 스타일 */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .image-modal.active {
            display: flex;
        }
        
        .modal-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2em;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .modal-close:hover {
            opacity: 0.7;
        }

        .reply-meta {
            display: flex;
            gap: 12px;
            font-size: 0.75em;
            color: #6b7280;
        }
        
        /* 모달 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #6b7280;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        /* 알림 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #059669;
        }
        
        .notification.error {
            background: #dc2626;
        }
        
        /* 게시글 액션 버튼 스타일 */
        .post-actions {
            display: flex;
            align-items: center;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        /* 삭제 확인 다이얼로그 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .confirm-dialog.active {
            display: flex;
        }
        
        .confirm-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .confirm-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .confirm-message {
            color: #6b7280;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn-confirm {
            background: #dc2626;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-cancel {
            background: #f3f4f6;
            color: #374151;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* 로딩 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #2563eb;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* API 테스트 스타일 */
        .api-test-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .api-section-title {
            background: #f8fafc;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.1em;
            font-weight: 600;
            color: #1f2937;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .api-endpoint-item {
            border-bottom: 1px solid #f3f4f6;
        }
        
        .api-endpoint-item:last-child {
            border-bottom: none;
        }
        
        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .endpoint-header:hover {
            background: #f9fafb;
        }
        
        .endpoint-toggle {
            margin-left: auto;
            transition: transform 0.2s;
            font-size: 0.8em;
        }
        
        .endpoint-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .api-test-panel {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .api-test-panel.expanded {
            max-height: none;
            opacity: 1;
            overflow: visible;
        }
        
        .test-panel-content {
            padding: 20px;
        }
        
        .test-form {
            display: grid;
            gap: 15px;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9em;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn-test {
            background: #059669;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-test:hover {
            background: #047857;
        }
        
        .btn-test:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .btn-clear {
            background: #f3f4f6;
            color: #374151;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
        }
        
        .api-response-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            min-height: 250px;
        }
        
        .response-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .response-tab {
            padding: 6px 12px;
            background: #e5e7eb;
            border: none;
            border-radius: 6px 6px 0 0;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .response-tab.active {
            background: #3b82f6;
            color: white;
        }
        
        .response-content {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 0 6px 6px 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8em;
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .method-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
            min-width: 45px;
            text-align: center;
        }
        
        .method-get { background: #dbeafe; color: #1e40af; }
        .method-post { background: #dcfce7; color: #166534; }
        .method-put { background: #fef3c7; color: #92400e; }
        .method-delete { background: #fee2e2; color: #991b1b; }
        
        .endpoint-path {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
            color: #374151;
            flex: 1;
        }
        
        .endpoint-status {
            font-size: 1.2em;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -250px;
                top: 0;
                height: 100vh;
                z-index: 100;
                transition: left 0.3s;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                width: 100%;
            }
            
            .content-header {
                padding: 15px 20px;
            }
            
            .content-body {
                padding: 20px;
            }
            
            .api-test-panel.expanded {
                max-height: none;
                overflow: visible;
            }
            
            .response-content {
                font-size: 0.7em;
                max-height: 400px;
            }
            
            .test-panel-content {
                padding: 15px;
            }
            
            .endpoint-header {
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 사이드바 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">🚀 FastAPI UI</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">메인</div>
                    <a class="nav-item active" onclick="showPage('dashboard', this)">
                        <span class="nav-icon">📊</span>
                        대시보드
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">인증</div>
                    <a class="nav-item" onclick="showPage('login', this)">
                        <span class="nav-icon">🔐</span>
                        로그인
                    </a>
                    <a class="nav-item" onclick="showPage('register', this)">
                        <span class="nav-icon">📝</span>
                        회원가입
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">콘텐츠</div>
                    <a class="nav-item" onclick="showPage('posts', this)">
                        <span class="nav-icon">📄</span>
                        게시글 목록
                    </a>
                    <a class="nav-item" onclick="showPage('post-detail', this)">
                        <span class="nav-icon">📖</span>
                        게시글 상세
                    </a>
                    <a class="nav-item" onclick="showPage('post-create', this)">
                        <span class="nav-icon">✍️</span>
                        게시글 작성
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">파일 관리</div>
                    <a class="nav-item" onclick="showPage('file-upload', this)">
                        <span class="nav-icon">📎</span>
                        파일 업로드 테스트
                    </a>
                </div>
            </nav>
        </aside>
        
        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 헤더 -->
            <header class="content-header">
                <div>
                    <h1 class="page-title" id="pageTitle">대시보드</h1>
                    <p class="page-subtitle" id="pageSubtitle">API 개발 현황 및 테스트</p>
                </div>
                
                <div class="auth-status">
                    <div class="auth-user" id="authUser" style="display: none;">
                        👤 사용자
                    </div>
                    <button class="btn-logout" onclick="logout()" style="display: none;">
                        로그아웃
                    </button>
                </div>
            </header>
            
            <!-- 콘텐츠 영역 -->
            <div class="content-body">
                <!-- 대시보드 페이지 -->
                <div class="page active" id="dashboard">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-title">완료된 API</div>
                            <div class="stat-value">14</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⏳</div>
                            <div class="stat-title">진행중 API</div>
                            <div class="stat-value">3</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📊</div>
                            <div class="stat-title">전체 진행률</div>
                            <div class="stat-value">85%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🧪</div>
                            <div class="stat-title">테스트 케이스</div>
                            <div class="stat-value">42</div>
                        </div>
                    </div>
                    
                    <!-- API 테스트 섹션 -->
                    <div style="margin-top: 30px;">
                        <h2 style="margin-bottom: 20px; font-size: 1.4em; color: #1f2937;">🧪 API 테스트</h2>
                        
                        <!-- 인증 API -->
                        <div class="api-test-section">
                            <h3 class="api-section-title">🔐 인증 API</h3>
                            
                            <div class="api-endpoint-item">
                                <div class="endpoint-header" onclick="toggleApiTest(this)">
                                    <span class="method-badge method-post">POST</span>
                                    <span class="endpoint-path">/auth/login</span>
                                    <span class="endpoint-status">✅</span>
                                    <span class="endpoint-toggle">▶</span>
                                </div>
                                <div class="api-test-panel">
                                    <div class="test-panel-content">
                                        <div class="test-form">
                                            <div class="form-group">
                                                <label class="form-label">이메일</label>
                                                <input type="email" class="form-input" placeholder="user@example.com" value="test@test.com">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">비밀번호</label>
                                                <input type="password" class="form-input" placeholder="password" value="password123">
                                            </div>
                                            <div class="test-buttons">
                                                <button class="btn-test" id="loginApiButton" data-method="POST" data-endpoint="/auth/login">
                                                    🚀 API 호출
                                                </button>
                                                <button class="btn-clear" onclick="clearApiForm(this)">지우기</button>
                                            </div>
                                        </div>
                                        <div class="api-response-section" style="display:none;">
                                            <div class="response-tabs">
                                                <button class="response-tab active">응답</button>
                                                <button class="response-tab">헤더</button>
                                                <button class="response-tab">요청</button>
                                            </div>
                                            <div class="response-content">
                                                <pre>응답 대기중...</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="api-endpoint-item">
                                <div class="endpoint-header" onclick="toggleApiTest(this)">
                                    <span class="method-badge method-post">POST</span>
                                    <span class="endpoint-path">/auth/register</span>
                                    <span class="endpoint-status">✅</span>
                                    <span class="endpoint-toggle">▶</span>
                                </div>
                                <div class="api-test-panel">
                                    <div class="test-panel-content">
                                        <div class="test-form">
                                            <div class="form-group">
                                                <label class="form-label">이메일</label>
                                                <input type="email" class="form-input" placeholder="user@example.com">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">사용자 핸들</label>
                                                <input type="text" class="form-input" placeholder="user_handle">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">표시 이름 (선택)</label>
                                                <input type="text" class="form-input" placeholder="Display Name">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">비밀번호</label>
                                                <input type="password" class="form-input" placeholder="password">
                                            </div>
                                            <div class="test-buttons">
                                                <button class="btn-test" onclick="testApiCall(this, 'POST', '/auth/register')">
                                                    🚀 API 호출
                                                </button>
                                                <button class="btn-clear" onclick="clearApiForm(this)">지우기</button>
                                            </div>
                                        </div>
                                        <div class="api-response-section" style="display:none;">
                                            <div class="response-tabs">
                                                <button class="response-tab active">응답</button>
                                                <button class="response-tab">헤더</button>
                                                <button class="response-tab">요청</button>
                                            </div>
                                            <div class="response-content">
                                                <pre>응답 대기중...</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 게시글 API -->
                        <div class="api-test-section">
                            <h3 class="api-section-title">📝 게시글 API</h3>
                            
                            <div class="api-endpoint-item">
                                <div class="endpoint-header" onclick="toggleApiTest(this)">
                                    <span class="method-badge method-get">GET</span>
                                    <span class="endpoint-path">/posts</span>
                                    <span class="endpoint-status">✅</span>
                                    <span class="endpoint-toggle">▶</span>
                                </div>
                                <div class="api-test-panel">
                                    <div class="test-panel-content">
                                        <div class="test-form">
                                            <div class="form-group">
                                                <label class="form-label">페이지</label>
                                                <input type="number" class="form-input" placeholder="1" value="1">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">개수</label>
                                                <input type="number" class="form-input" placeholder="10" value="10">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">타입 (선택)</label>
                                                <input type="text" class="form-input" placeholder="자유게시판">
                                            </div>
                                            <div class="test-buttons">
                                                <button class="btn-test" onclick="testApiCall(this, 'GET', '/posts')">
                                                    🚀 API 호출
                                                </button>
                                                <button class="btn-clear" onclick="clearApiForm(this)">지우기</button>
                                            </div>
                                        </div>
                                        <div class="api-response-section" style="display:none;">
                                            <div class="response-tabs">
                                                <button class="response-tab active">응답</button>
                                                <button class="response-tab">헤더</button>
                                                <button class="response-tab">요청</button>
                                            </div>
                                            <div class="response-content">
                                                <pre>응답 대기중...</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="api-endpoint-item">
                                <div class="endpoint-header" onclick="toggleApiTest(this)">
                                    <span class="method-badge method-post">POST</span>
                                    <span class="endpoint-path">/posts</span>
                                    <span class="endpoint-status">✅</span>
                                    <span class="endpoint-toggle">▶</span>
                                </div>
                                <div class="api-test-panel">
                                    <div class="test-panel-content">
                                        <div class="test-form">
                                            <div class="form-group">
                                                <label class="form-label">제목</label>
                                                <input type="text" class="form-input" placeholder="게시글 제목">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">내용</label>
                                                <textarea class="form-textarea" placeholder="게시글 내용을 입력하세요..."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">서비스</label>
                                                <select class="form-input">
                                                    <option value="community">community</option>
                                                    <option value="shopping">shopping</option>
                                                    <option value="apartment">apartment</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Authorization Header</label>
                                                <input type="text" class="form-input" placeholder="Bearer your_token_here">
                                            </div>
                                            <div class="test-buttons">
                                                <button class="btn-test" onclick="testApiCall(this, 'POST', '/posts')">
                                                    🚀 API 호출
                                                </button>
                                                <button class="btn-clear" onclick="clearApiForm(this)">지우기</button>
                                            </div>
                                        </div>
                                        <div class="api-response-section" style="display:none;">
                                            <div class="response-tabs">
                                                <button class="response-tab active">응답</button>
                                                <button class="response-tab">헤더</button>
                                                <button class="response-tab">요청</button>
                                            </div>
                                            <div class="response-content">
                                                <pre>응답 대기중...</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 댓글 API -->
                        <div class="api-test-section">
                            <h3 class="api-section-title">💬 댓글 API</h3>
                            
                            <div class="api-endpoint-item">
                                <div class="endpoint-header" onclick="toggleApiTest(this)">
                                    <span class="method-badge method-get">GET</span>
                                    <span class="endpoint-path">/posts/{slug}/comments</span>
                                    <span class="endpoint-status">✅</span>
                                    <span class="endpoint-toggle">▶</span>
                                </div>
                                <div class="api-test-panel">
                                    <div class="test-panel-content">
                                        <div class="test-form">
                                            <div class="form-group">
                                                <label class="form-label">게시글 Slug</label>
                                                <input type="text" class="form-input" placeholder="post-slug-here">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">페이지</label>
                                                <input type="number" class="form-input" placeholder="1" value="1">
                                            </div>
                                            <div class="test-buttons">
                                                <button class="btn-test" onclick="testApiCall(this, 'GET', '/posts/{slug}/comments')">
                                                    🚀 API 호출
                                                </button>
                                                <button class="btn-clear" onclick="clearApiForm(this)">지우기</button>
                                            </div>
                                        </div>
                                        <div class="api-response-section" style="display:none;">
                                            <div class="response-tabs">
                                                <button class="response-tab active">응답</button>
                                                <button class="response-tab">헤더</button>
                                                <button class="response-tab">요청</button>
                                            </div>
                                            <div class="response-content">
                                                <pre>응답 대기중...</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 로그인 페이지 -->
                <div class="page" id="login">
                    <div class="auth-container">
                        <div class="auth-card">
                            <h2 class="auth-title">로그인</h2>
                            <form onsubmit="handleLogin(event)">
                                <div class="form-group">
                                    <label class="form-label">이메일</label>
                                    <input type="email" class="form-input" name="email" required 
                                           placeholder="example@email.com" value="test@test.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">비밀번호</label>
                                    <input type="password" class="form-input" name="password" required 
                                           placeholder="비밀번호" value="password123">
                                </div>
                                <button type="submit" class="btn-primary" id="loginBtn">
                                    로그인
                                </button>
                            </form>
                            <div class="auth-switch">
                                계정이 없으신가요? <a href="#" onclick="showPage('register')">회원가입</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 회원가입 페이지 -->
                <div class="page" id="register">
                    <div class="auth-container">
                        <div class="auth-card">
                            <h2 class="auth-title">회원가입</h2>
                            <form onsubmit="handleRegister(event)">
                                <div class="form-group">
                                    <label class="form-label">이메일</label>
                                    <input type="email" class="form-input" name="email" required 
                                           placeholder="example@email.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">사용자 핸들</label>
                                    <input type="text" class="form-input" name="user_handle" required 
                                           placeholder="user_handle">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">표시 이름</label>
                                    <input type="text" class="form-input" name="display_name" 
                                           placeholder="표시 이름 (선택사항)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">비밀번호</label>
                                    <input type="password" class="form-input" name="password" required 
                                           placeholder="비밀번호">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">비밀번호 확인</label>
                                    <input type="password" class="form-input" name="confirm_password" required 
                                           placeholder="비밀번호 확인">
                                </div>
                                <button type="submit" class="btn-primary" id="registerBtn">
                                    회원가입
                                </button>
                            </form>
                            <div class="auth-switch">
                                이미 계정이 있으신가요? <a href="#" onclick="showPage('login')">로그인</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 게시글 목록 페이지 -->
                <div class="page" id="posts">
                    <div class="posts-header">
                        <h2>게시글 목록</h2>
                        <button class="btn-new-post" onclick="showPage('post-create')">
                            ✍️ 새 게시글
                        </button>
                    </div>
                    
                    <div class="posts-filters">
                        <div class="filters-row">
                            <div class="filter-group">
                                <label class="filter-label">서비스</label>
                                <select class="filter-select" id="serviceFilter" onchange="updateTypeFilter()">
                                    <option value="">전체</option>
                                    <option value="apartment" selected>아파트</option>
                                    <option value="shopping">쇼핑</option>
                                    <option value="community">커뮤니티</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">타입</label>
                                <select class="filter-select" id="typeFilter" onchange="filterPosts()">
                                    <option value="">전체</option>
                                    <option value="입주 정보">입주 정보</option>
                                    <option value="생활 정보">생활 정보</option>
                                    <option value="이야기">이야기</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">정렬</label>
                                <select class="filter-select" onchange="sortPosts()">
                                    <option value="created_at">최신순</option>
                                    <option value="views">조회수순</option>
                                    <option value="likes">좋아요순</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">검색</label>
                                <input type="text" class="form-input" id="searchInput" placeholder="제목 및 내용 검색..." 
                                       onkeyup="searchPosts(this.value)" oninput="filterPosts()" style="width: 200px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="posts-list" id="postsList">
                        <!-- 게시글들이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
                
                <!-- 게시글 상세 페이지 -->
                <div class="page" id="post-detail">
                    <div class="post-detail">
                        <div class="post-detail-header">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                <button onclick="showPage('posts')" style="background: #f3f4f6; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px; color: #374151; font-size: 0.9em;">
                                    ← 목록으로
                                </button>
                                
                                <!-- 작성자만 보이는 수정/삭제 버튼 -->
                                <div class="post-actions" id="postActions" style="display: none; gap: 10px;">
                                    <button onclick="editCurrentPost()" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                        ✏️ 수정
                                    </button>
                                    <button onclick="deleteCurrentPost()" style="background: #dc2626; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                        🗑️ 삭제
                                    </button>
                                </div>
                            </div>
                            <div class="post-detail-title" id="postDetailTitle">
                                게시글 제목
                            </div>
                            <div class="post-detail-meta">
                                <span class="post-type">자유게시판</span>
                                <span>•</span>
                                <span>작성자: user123</span>
                                <span>•</span>
                                <span>2024-01-15 14:30</span>
                            </div>
                            <div class="post-reactions">
                                <button class="reaction-btn" onclick="toggleReaction('like')">
                                    👍 <span id="likeCount">15</span>
                                </button>
                                <button class="reaction-btn" onclick="toggleReaction('dislike')">
                                    👎 <span id="dislikeCount">2</span>
                                </button>
                                <button class="reaction-btn" onclick="toggleReaction('bookmark')">
                                    🔖 <span id="bookmarkCount">8</span>
                                </button>
                            </div>
                        </div>
                        <div class="post-content" id="postDetailContent">
                            <p>게시글 내용이 여기에 표시됩니다...</p>
                        </div>
                        
                        <!-- 첨부 파일 섹션 -->
                        <div class="post-attachments" id="postAttachments" style="display: none;">
                            <div class="attachments-header">
                                <h4>첨부 이미지</h4>
                            </div>
                            <div class="attachments-grid" id="attachmentsGrid">
                                <!-- 첨부 이미지들이 여기에 동적으로 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 댓글 섹션 -->
                    <div class="comments-section">
                        <div class="comments-header">
                            댓글 <span id="commentCount">12</span>개
                        </div>
                        
                        <div class="comment-form">
                            <textarea class="comment-textarea" placeholder="댓글을 작성해주세요..." id="commentTextarea"></textarea>
                            <div class="comment-actions">
                                <button class="btn-comment" onclick="addComment()">
                                    댓글 작성
                                </button>
                            </div>
                        </div>
                        
                        <div class="comments-list" id="commentsList">
                            <!-- 댓글들이 여기에 동적으로 추가됩니다 -->
                        </div>
                    </div>
                </div>
                
                <!-- 게시글 수정 페이지 -->
                <div class="page" id="post-edit">
                    <div class="auth-container" style="max-width: 800px;">
                        <div class="auth-card">
                            <h2 class="auth-title">게시글 수정</h2>
                            <form onsubmit="handleUpdatePost(event)" id="editPostForm">
                                <div class="form-group">
                                    <label class="form-label">제목</label>
                                    <input type="text" class="form-input" name="title" id="editPostTitle" required 
                                           placeholder="게시글 제목을 입력하세요">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">내용</label>
                                    <textarea class="form-textarea" name="content" id="editPostContent" required 
                                              placeholder="게시글 내용을 입력하세요" rows="8"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">서비스</label>
                                    <select class="form-input" name="service" id="editPostService" required onchange="updateEditPostType()">
                                        <option value="">서비스 선택</option>
                                        <option value="apartment">아파트</option>
                                        <option value="shopping">쇼핑</option>
                                        <option value="community">커뮤니티</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">타입</label>
                                    <select class="form-input" name="type" id="editPostType" required>
                                        <option value="">타입 선택</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">태그 (콤마로 구분, 최대 3개)</label>
                                    <input type="text" class="form-input" name="tags" id="editPostTags" 
                                           placeholder="태그1, 태그2, 태그3">
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button type="submit" class="btn-primary" id="updatePostBtn">
                                        수정 완료
                                    </button>
                                    <button type="button" class="btn-secondary" onclick="showPage('post-detail')">
                                        취소
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 게시글 작성 페이지 -->
                <div class="page" id="post-create">
                    <div class="auth-container" style="max-width: 800px;">
                        <div class="auth-card">
                            <h2 class="auth-title">새 게시글 작성</h2>
                            <form onsubmit="handleCreatePost(event)">
                                <div class="form-group">
                                    <label class="form-label">제목</label>
                                    <input type="text" class="form-input" name="title" required 
                                           placeholder="게시글 제목을 입력하세요">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">서비스</label>
                                    <select class="form-input" name="service" id="createPostService" required onchange="updateCreatePostType()">
                                        <option value="apartment">아파트</option>
                                        <option value="shopping">쇼핑</option>
                                        <option value="community">커뮤니티</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">타입</label>
                                    <select class="form-input" name="type" id="createPostType" required>
                                        <option value="입주 정보">입주 정보</option>
                                        <option value="생활 정보">생활 정보</option>
                                        <option value="이야기">이야기</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">내용</label>
                                    <textarea class="form-input" name="content" required 
                                              placeholder="게시글 내용을 입력하세요..." 
                                              style="min-height: 200px; resize: vertical;"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">태그 (쉼표로 구분)</label>
                                    <input type="text" class="form-input" name="tags" 
                                           placeholder="태그1, 태그2, 태그3">
                                </div>
                                
                                <!-- 파일 첨부 기능 -->
                                <div class="form-group">
                                    <label class="form-label">파일 첨부</label>
                                    <div class="file-upload-area" id="postFileUpload">
                                        <div class="file-upload-content">
                                            <div class="file-upload-icon">📁</div>
                                            <div class="file-upload-text">
                                                <p>파일을 드래그하여 업로드하거나 클릭하여 선택하세요</p>
                                                <p class="file-upload-hint">이미지 파일 (JPG, PNG, GIF) - 최대 10MB</p>
                                            </div>
                                            <input type="file" id="postFileInput" multiple accept="image/*" style="display: none;">
                                        </div>
                                        <div class="uploaded-files" id="postUploadedFiles" style="display: none;">
                                            <h4>첨부된 파일:</h4>
                                            <div class="file-list" id="postFileList"></div>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary" id="createPostBtn">
                                    게시글 작성
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 파일 업로드 테스트 페이지 -->
                <div class="page" id="file-upload">
                    <div class="auth-container" style="max-width: 800px;">
                        <div class="auth-card">
                            <h2 class="auth-title">📎 파일 업로드 테스트</h2>
                            <p style="text-align: center; color: #6b7280; margin-bottom: 30px;">
                                파일 관리 API (Task 1-6) 통합 테스트
                            </p>
                            
                            <!-- 업로드 섹션 -->
                            <div style="border: 2px dashed #d1d5db; border-radius: 12px; padding: 30px; margin-bottom: 30px; text-align: center; transition: all 0.2s;" id="uploadArea">
                                <div style="font-size: 3em; margin-bottom: 10px;">📤</div>
                                <h3>파일을 선택하거나 드래그해서 업로드</h3>
                                <p style="color: #6b7280; margin: 10px 0;">지원 형식: JPG, JPEG, PNG, GIF, WEBP (최대 5MB)</p>
                                
                                <form id="fileUploadForm" style="margin-top: 20px;">
                                    <input type="file" id="fileInput" name="file" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                                    <button type="button" class="btn-primary" onclick="document.getElementById('fileInput').click()">
                                        파일 선택
                                    </button>
                                    
                                    <!-- 첨부 옵션 -->
                                    <div style="margin-top: 20px; text-align: left;">
                                        <label class="form-label">첨부 타입 (선택)</label>
                                        <select class="form-input" id="attachmentType" name="attachment_type">
                                            <option value="">선택 안함</option>
                                            <option value="post">게시글</option>
                                            <option value="comment">댓글</option>
                                            <option value="profile">프로필</option>
                                        </select>
                                    </div>
                                    
                                    <div style="margin-top: 15px; text-align: left;">
                                        <label class="form-label">첨부 ID (선택)</label>
                                        <input type="text" class="form-input" id="attachmentId" name="attachment_id" placeholder="예: post_123, comment_456">
                                    </div>
                                </form>
                            </div>
                            
                            <!-- 파일 정보 표시 -->
                            <div id="fileInfo" style="display: none; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                                <h4 style="color: #0369a1; margin-bottom: 10px;">📋 선택된 파일</h4>
                                <div id="fileDetails"></div>
                                <div style="margin-top: 15px;">
                                    <button type="button" class="btn-primary" onclick="uploadSelectedFile()" id="uploadBtn">
                                        업로드 시작
                                    </button>
                                    <button type="button" class="btn-secondary" onclick="clearFileSelection()">
                                        취소
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 업로드 진행상황 -->
                            <div id="uploadProgress" style="display: none; margin-bottom: 20px;">
                                <div style="background: #f3f4f6; border-radius: 8px; padding: 4px;">
                                    <div id="progressBar" style="background: #10b981; height: 8px; border-radius: 4px; width: 0%; transition: width 0.3s;"></div>
                                </div>
                                <p style="text-align: center; margin-top: 10px; color: #6b7280;" id="progressText">업로드 중...</p>
                            </div>
                            
                            <!-- 업로드 결과 -->
                            <div id="uploadResult" style="display: none;">
                                <h4 style="color: #059669; margin-bottom: 15px;">✅ 업로드 성공!</h4>
                                <div id="resultDetails" style="background: #f0fdf4; border: 1px solid #16a34a; border-radius: 8px; padding: 20px;"></div>
                                <div style="margin-top: 15px;">
                                    <button type="button" class="btn-primary" onclick="resetUploadForm()">
                                        새 파일 업로드
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 오류 표시 -->
                            <div id="uploadError" style="display: none;">
                                <h4 style="color: #dc2626; margin-bottom: 15px;">❌ 업로드 실패</h4>
                                <div id="errorDetails" style="background: #fef2f2; border: 1px solid #ef4444; border-radius: 8px; padding: 20px; color: #dc2626;"></div>
                                <div style="margin-top: 15px;">
                                    <button type="button" class="btn-primary" onclick="resetUploadForm()">
                                        다시 시도
                                    </button>
                                </div>
                            </div>
                            
                            <!-- API 테스트 로그 -->
                            <div style="margin-top: 30px;">
                                <h4 style="margin-bottom: 15px;">🔧 API 테스트 로그</h4>
                                <div id="apiLog" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9em;">
                                    <div style="color: #6b7280;">API 호출 로그가 여기에 표시됩니다...</div>
                                </div>
                                <button type="button" class="btn-secondary" onclick="clearApiLog()" style="margin-top: 10px;">
                                    로그 지우기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 관리자 페이지 제거됨 -->
                
                <!-- API 테스트 페이지 제거됨 -->
            </div>
        </main>
    </div>
    
    <!-- 모달 -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">제목</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                내용
            </div>
        </div>
    </div>
    
    <!-- 알림 -->
    <div class="notification" id="notification"></div>
    
    <!-- 삭제 확인 다이얼로그 -->
    <div class="confirm-dialog" id="deleteConfirmDialog">
        <div class="confirm-content">
            <div class="confirm-title">게시글 삭제</div>
            <div class="confirm-message">
                정말로 이 게시글을 삭제하시겠습니까?<br>
                삭제된 게시글은 복구할 수 없습니다.
            </div>
            <div class="confirm-buttons">
                <button class="btn-confirm" onclick="confirmDeletePost()">삭제</button>
                <button class="btn-cancel" onclick="cancelDeletePost()">취소</button>
            </div>
        </div>
    </div>
    
    <script>
        // API 설정
        const API_BASE_URL = 'http://localhost:8000';
        
        // 전역 상태
        let currentUser = null;
        let posts = [];
        let comments = [];
        let reactions = {};
        let currentPost = null; // 현재 보고 있는 게시글
        let postsCache = new Map(); // 게시글 캐시 (slug -> post data)
        
        // API 헬퍼 함수
        function getAuthHeaders() {
            const token = localStorage.getItem('authToken');
            console.log('Current auth token:', token ? token.substring(0, 20) + '...' : 'null');
            return token ? { 'Authorization': `Bearer ${token}` } : {};
        }
        
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...getAuthHeaders(),
                    ...options.headers
                }
            };
            
            console.log('Making API call to:', url);
            console.log('Options:', { ...defaultOptions, ...options });
            
            try {
                const response = await fetch(url, { ...defaultOptions, ...options });
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API error response:', errorText);
                    
                    // Handle authentication errors
                    if (response.status === 401) {
                        // Clear invalid token and redirect to login
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('currentUser');
                        currentUser = null;
                        updateAuthUI();
                        showNotification('인증이 만료되었습니다. 다시 로그인해주세요.', 'error');
                        showPage('login');
                        return;
                    }
                    
                    // Try to parse as JSON for better error messages
                    try {
                        const errorData = JSON.parse(errorText);
                        throw new Error(`HTTP ${response.status}: ${errorData.detail || errorText}`);
                    } catch {
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                }
                
                // Handle 204 No Content responses (like DELETE operations)
                if (response.status === 204) {
                    return { success: true };
                }
                
                // Check if response has content before parsing JSON
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return await response.json();
                } else {
                    // Return success object for non-JSON responses
                    return { success: true };
                }
            } catch (error) {
                console.error('API call failed:', error);
                showNotification('API 호출 실패: ' + error.message, 'error');
                throw error;
            }
        }
        
        // 서비스별 타입 정의
        const serviceTypes = {
            apartment: ["입주 정보", "생활 정보", "이야기"],
            shopping: ["상품 문의", "배송 문의", "교환/환불", "기타"],
            community: ["자유게시판", "질문답변", "공지사항", "후기"]
        };
        
        // 모의 데이터
        const mockPosts = [
            {
                id: "post1",
                title: "입주자 모집 안내문",
                content: "2024년 3월 입주예정인 신규 아파트 입주자를 모집합니다. 자세한 내용은...",
                author_id: "user1",
                slug: "apt-move-in-guide-2024",
                service: "apartment",
                metadata: {
                    type: "입주 정보",
                    tags: ["신규입주", "2024년"],
                    visibility: "public"
                },
                created_at: "2024-01-15T14:30:00",
                view_count: 324,
                like_count: 45,
                dislike_count: 2,
                comment_count: 18
            },
            {
                id: "post2",
                title: "주차장 이용 규정 변경 안내",
                content: "아파트 주차장 이용 규정이 다음과 같이 변경됩니다...",
                author_id: "user2",
                slug: "parking-rule-change-2024",
                service: "apartment",
                metadata: {
                    type: "생활 정보",
                    tags: ["주차", "규정"],
                    visibility: "public"
                },
                created_at: "2024-01-14T09:15:00",
                view_count: 189,
                like_count: 22,
                dislike_count: 5,
                comment_count: 12
            },
            {
                id: "post3",
                title: "관리비 절약 노하우",
                content: "매달 나가는 관리비를 절약하는 방법들을 공유합니다...",
                author_id: "user3",
                slug: "save-management-fee-tips",
                service: "apartment",
                metadata: {
                    type: "이야기",
                    tags: ["절약", "관리비"],
                    visibility: "public"
                },
                created_at: "2024-01-13T16:45:00",
                view_count: 567,
                like_count: 89,
                dislike_count: 1,
                comment_count: 34
            }
        ];
        
        
        // 게시글 API 함수들
        async function loadPosts() {
            try {
                const response = await apiCall('/api/posts/');
                console.log('Posts API response:', response);
                posts = response.items || [];
                console.log('Loaded posts with stats:', posts);
                
                // 전체 posts 데이터를 글로벌 변수에 저장 (필터링용)
                window.allPosts = [...posts];
                
                // 캐시 업데이트
                postsCache.clear();
                posts.forEach(post => {
                    const key = post.slug || post._id || post.id;
                    postsCache.set(key, post);
                });
                
                renderPosts();
            } catch (error) {
                // API 실패시 모의 데이터 사용
                console.warn('Failed to load posts from API, using mock data:', error);
                posts = [...mockPosts];
                window.allPosts = [...mockPosts];
                renderPosts();
            }
        }
        
        async function createPost(postData) {
            try {
                const newPost = await apiCall('/api/posts/', {
                    method: 'POST',
                    body: JSON.stringify(postData)
                });
                showNotification('게시글이 성공적으로 작성되었습니다!', 'success');
                await loadPosts(); // 목록 새로고침
                
                console.log('새로 작성된 게시글:', newPost);
                console.log('현재 사용자:', currentUser);
                
                return newPost;
            } catch (error) {
                console.warn('API 호출 실패, 모의 게시글 생성:', error);
                
                // API 실패 시 모의 게시글 생성
                const mockPost = {
                    id: `post_${Date.now()}`,
                    slug: `post-${Date.now()}`,
                    title: postData.title,
                    content: postData.content,
                    service: postData.service,
                    metadata: postData.metadata,
                    file_ids: postData.metadata?.file_ids || [], // API 명세에 따라 file_ids 사용
                    author_id: currentUser?.email || 'test_user',
                    created_at: new Date().toISOString(),
                    view_count: 0,
                    like_count: 0,
                    dislike_count: 0,
                    comment_count: 0,
                    stats: {
                        view_count: 0,
                        like_count: 0,
                        dislike_count: 0,
                        comment_count: 0,
                        bookmark_count: 0
                    }
                };
                
                // 모의 데이터 배열에 추가
                mockPosts.unshift(mockPost);
                posts.unshift(mockPost);
                window.allPosts = [...posts];
                
                // 캐시에도 추가
                postsCache.set(mockPost.slug, mockPost);
                
                showNotification('게시글이 성공적으로 작성되었습니다! (테스트 모드)', 'success');
                return mockPost;
            }
        }
        
        async function searchPosts(query) {
            try {
                const response = await apiCall(`/api/posts/search?q=${encodeURIComponent(query)}`);
                posts = response.items || [];
                renderPosts();
            } catch (error) {
                showNotification('검색에 실패했습니다.', 'error');
            }
        }
        
        // 초기화
        async function init() {
            // 전역 함수 등록 (onclick 이벤트에서 접근 가능하도록)
            window.togglePostReaction = togglePostReaction;
            window.toggleCommentReaction = toggleCommentReaction;
            window.replyToComment = replyToComment;
            window.addComment = addComment;
            window.submitReply = submitReply;
            window.cancelReply = cancelReply;
            window.editCurrentPost = editCurrentPost;
            window.deleteCurrentPost = deleteCurrentPost;
            window.confirmDeletePost = confirmDeletePost;
            window.cancelDeletePost = cancelDeletePost;
            window.updatePostActions = updatePostActions;
            window.removePostFile = removePostFile;
            window.openImageModal = openImageModal;
            window.closeImageModal = closeImageModal;
            // 테스트 함수 제거 - 콘솔 스팸 방지
            
            // 전역 함수 등록 완료
            
            // 게시글 로드
            await loadPosts();
            
            // 게시글 작성 파일 업로드 초기화
            initPostFileUpload();
            
            // 로그인 상태 확인
            const token = localStorage.getItem('authToken');
            if (token) {
                try {
                    // 토큰이 있으면 사용자 정보를 localStorage에서 가져오거나 기본값 설정
                    const storedUser = localStorage.getItem('currentUser');
                    if (storedUser) {
                        currentUser = JSON.parse(storedUser);
                        console.log('사용자 정보 복원됨:', currentUser);
                    } else {
                        console.warn('localStorage에 사용자 정보가 없습니다. 다시 로그인이 필요할 수 있습니다.');
                        // 토큰만 있고 사용자 정보가 없는 경우 토큰 제거
                        localStorage.removeItem('authToken');
                        currentUser = null;
                    }
                    updateAuthUI();
                } catch (error) {
                    console.error('Login state check error:', error);
                    // 토큰이 유효하지 않으면 제거
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('currentUser');
                    currentUser = null;
                    updateAuthUI();
                }
            }
        }
        
        // 페이지 전환
        function showPage(pageId, targetElement = null) {
            // 모든 페이지 숨기기
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 선택된 페이지 보이기
            document.getElementById(pageId).classList.add('active');
            
            // 네비게이션 업데이트
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // targetElement가 전달되면 활성화, 아니면 pageId로 찾기
            if (targetElement) {
                targetElement.classList.add('active');
            } else {
                // pageId에 해당하는 nav-item 찾기
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    const onclick = item.getAttribute('onclick');
                    if (onclick && onclick.includes(`'${pageId}'`)) {
                        item.classList.add('active');
                    }
                });
            }
            
            // 페이지 제목 업데이트
            const titles = {
                dashboard: '대시보드',
                login: '로그인',
                register: '회원가입',
                posts: '게시글 목록',
                'post-detail': '게시글 상세',
                'post-create': '게시글 작성',
                'file-upload': '파일 업로드 테스트'
            };
            
            const subtitles = {
                dashboard: 'API 개발 현황 및 테스트',
                login: '계정에 로그인하세요',
                register: '새 계정을 만드세요',
                posts: '모든 게시글을 확인하세요',
                'post-detail': '게시글 내용 및 댓글',
                'post-create': '새로운 게시글을 작성하세요',
                'file-upload': '파일 관리 API (Task 1-6) 통합 테스트'
            };
            
            document.getElementById('pageTitle').textContent = titles[pageId] || '';
            document.getElementById('pageSubtitle').textContent = subtitles[pageId] || '';
            
            // 특정 페이지에 대한 추가 로직
            if (pageId === 'posts') {
                // 게시글 목록 페이지 표시 시 게시글 목록 새로고침
                // 항상 최신 데이터를 가져오도록 강제
                loadPosts();
            }
        }
        
        // 인증 관련
        async function handleLogin(event) {
            event.preventDefault();
            const btn = document.getElementById('loginBtn');
            const form = event.target;
            const formData = new FormData(form);
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> 로그인 중...';
            
            try {
                const email = formData.get('email');
                const password = formData.get('password');
                
                if (!email || !password) {
                    throw new Error('이메일과 비밀번호를 모두 입력해주세요.');
                }
                
                // 실제 API 호출 (OAuth2 FormData 형식)
                const loginFormData = new FormData();
                loginFormData.append('username', email);  // OAuth2에서는 username 필드 사용
                loginFormData.append('password', password);
                
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    body: loginFormData  // FormData는 Content-Type 헤더를 자동으로 설정
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // 로그인 성공
                    if (data.access_token) {
                        localStorage.setItem('authToken', data.access_token);
                        currentUser = data.user || { email: email, display_name: email.split('@')[0] };
                        
                        // 사용자 정보도 localStorage에 저장
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        updateAuthUI();
                        showNotification('로그인 성공!', 'success');
                        showPage('dashboard');
                    } else {
                        throw new Error('토큰을 받지 못했습니다.');
                    }
                } else {
                    throw new Error(data.detail || '로그인에 실패했습니다.');
                }
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '로그인';
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            const btn = document.getElementById('registerBtn');
            const form = event.target;
            const formData = new FormData(form);
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> 가입 중...';
            
            try {
                // 비밀번호 확인
                if (formData.get('password') !== formData.get('confirm_password')) {
                    throw new Error('비밀번호가 일치하지 않습니다.');
                }
                
                const email = formData.get('email');
                const userHandle = formData.get('user_handle');
                const displayName = formData.get('display_name');
                const password = formData.get('password');
                
                if (!email || !userHandle || !password) {
                    throw new Error('필수 정보를 모두 입력해주세요.');
                }
                
                // 실제 API 호출
                const registerData = {
                    email: email,
                    user_handle: userHandle,
                    password: password
                };
                
                // display_name이 있으면 추가
                if (displayName && displayName.trim()) {
                    registerData.display_name = displayName.trim();
                }
                
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(registerData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('회원가입 완료! 로그인해주세요.', 'success');
                    showPage('login');
                } else {
                    throw new Error(data.detail || '회원가입에 실패했습니다.');
                }
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '회원가입';
            }
        }
        
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            currentUser = null;
            updateAuthUI();
            showNotification('로그아웃되었습니다.', 'success');
            showPage('login');
        }
        
        function updateAuthUI() {
            try {
                const authUser = document.getElementById('authUser');
                const logoutBtn = document.querySelector('.btn-logout');
                
                if (!authUser || !logoutBtn) {
                    console.error('Auth UI elements not found');
                    return;
                }
                
                if (currentUser) {
                    const displayText = currentUser.display_name || currentUser.email || 'User';
                    authUser.textContent = `👤 ${displayText}`;
                    authUser.style.display = 'block';
                    logoutBtn.style.display = 'block';
                } else {
                    authUser.style.display = 'none';
                    logoutBtn.style.display = 'none';
                }
            } catch (error) {
                console.error('Error updating auth UI:', error);
            }
        }
        
        // 게시글 관련
        function renderPosts() {
            const postsList = document.getElementById('postsList');
            if (!postsList) return;
            
            postsList.innerHTML = posts.map(post => {
                const tags = post.metadata?.tags || [];
                const type = post.metadata?.type || '';
                
                return `
                    <div class="post-card" onclick="showPostDetail('${post.slug || post.id}')">
                        <div class="post-meta">
                            <span class="post-type">${type}</span>
                            <span>•</span>
                            <span>작성자: ${post.author_id || 'Unknown'}</span>
                            <span>•</span>
                            <span>${formatDate(post.created_at)}</span>
                        </div>
                        <div class="post-title">${post.title}</div>
                        <div class="post-stats" style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
                            <div style="display: flex; gap: 15px;">
                                <span style="color: #6b7280;">👁 ${(post.stats?.view_count || post.view_count) || 0}</span>
                                <span style="color: #6b7280;">💬 ${(post.stats?.comment_count || post.comment_count) || 0}</span>
                                ${tags.length > 0 ? `<span style="color: #6b7280;">🏷️ ${tags.join(', ')}</span>` : ''}
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="event.stopPropagation(); togglePostReaction('${post.slug || post.id}', 'like')" 
                                        style="background: none; border: 1px solid #d1d5db; border-radius: 4px; padding: 4px 8px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 0.8em;">
                                    👍 ${(post.stats?.like_count || post.like_count) || 0}
                                </button>
                                <button onclick="event.stopPropagation(); togglePostReaction('${post.slug || post.id}', 'dislike')" 
                                        style="background: none; border: 1px solid #d1d5db; border-radius: 4px; padding: 4px 8px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 0.8em;">
                                    👎 ${(post.stats?.dislike_count || post.dislike_count) || 0}
                                </button>
                                <button onclick="event.stopPropagation(); togglePostReaction('${post.slug || post.id}', 'bookmark')" 
                                        style="background: none; border: 1px solid #d1d5db; border-radius: 4px; padding: 4px 8px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 0.8em;">
                                    🔖 ${(post.stats?.bookmark_count || post.bookmark_count) || 0}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        async function showPostDetail(postSlugOrId) {
            console.log('Showing post detail for:', postSlugOrId);
            
            try {
                // API에서 최신 게시글 데이터 가져오기 (조회수 증가 포함)
                const response = await apiCall(`/api/posts/${postSlugOrId}`);
                console.log('Post detail API response:', response);
                
                const post = response;
                
                // 게시글 데이터 저장 (댓글 등에서 사용)
                window.currentPost = post;
                currentPost = post; // 전역 변수도 설정
                
                // 캐시에 최신 데이터 업데이트
                const key = post.slug || post._id || post.id;
                postsCache.set(key, post)
            
            console.log('Current post set:', currentPost);
            
            // 상세 페이지 업데이트
            document.getElementById('postDetailTitle').textContent = post.title;
            document.getElementById('postDetailContent').innerHTML = `<p>${post.content}</p>`;
            
            // 첨부 파일 표시
            console.log('=== showPostDetail에서 첨부 파일 처리 ===');
            console.log('게시글 객체:', post);
            console.log('파일 IDs:', post.file_ids || post.metadata?.file_ids);
            
            // API 명세에 따라 file_ids 사용
            const fileIds = post.file_ids || post.metadata?.file_ids || [];
            await displayPostAttachments(fileIds);
            
            // 메타 정보 업데이트
            const detailMeta = document.querySelector('.post-detail-meta');
            detailMeta.innerHTML = `
                <span class="post-type">${post.metadata?.type || ''}</span>
                <span>•</span>
                <span>작성자: ${post.author_id || 'Unknown'}</span>
                <span>•</span>
                <span>${formatDate(post.created_at)}</span>
            `;
            
            // 통계 업데이트 (stats 객체가 있으면 사용, 없으면 직접 필드 사용)
            document.getElementById('likeCount').textContent = (post.stats?.like_count || post.like_count) || 0;
            document.getElementById('dislikeCount').textContent = (post.stats?.dislike_count || post.dislike_count) || 0;
            document.getElementById('bookmarkCount').textContent = (post.stats?.bookmark_count || post.bookmark_count) || 0;
            
                // 페이지 전환
                showPage('post-detail');
                
                // 작성자 권한 체크 및 수정/삭제 버튼 표시 업데이트
                setTimeout(() => {
                    updatePostActions();
                }, 100);
                
                // 댓글 초기화 및 로드
                comments = []; // 이전 댓글 데이터 클리어
                await loadComments(post.slug);
                
            } catch (error) {
                console.error('Failed to load post detail:', error);
                showNotification('게시글을 불러오는데 실패했습니다.', 'error');
                showPage('posts');
            }
        }
        
        async function handleCreatePost(event) {
            event.preventDefault();
            
            // Debug token status
            const token = localStorage.getItem('authToken');
            console.log('Create post - Token exists:', !!token);
            console.log('Create post - Current user:', currentUser);
            
            if (!currentUser || !token) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            const btn = document.getElementById('createPostBtn');
            const form = event.target;
            const formData = new FormData(form);
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> 작성 중...';
            
            try {
                // 먼저 파일들을 업로드
                const fileIds = [];
                if (postUploadedFiles.length > 0) {
                    console.log('첨부 파일 업로드 시작:', postUploadedFiles);
                    btn.innerHTML = '<span class="loading"></span> 파일 업로드 중...';
                    
                    for (const file of postUploadedFiles) {
                        try {
                            // 파일 업로드 API 호출
                            const uploadFormData = new FormData();
                            uploadFormData.append('file', file);
                            uploadFormData.append('attachment_type', 'post');
                            
                            const uploadResponse = await fetch(`${API_BASE_URL}/api/files/upload`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${token}`
                                },
                                body: uploadFormData
                            });
                            
                            if (uploadResponse.ok) {
                                const uploadResult = await uploadResponse.json();
                                console.log('파일 업로드 성공:', uploadResult);
                                fileIds.push(uploadResult.file_id);
                            } else {
                                const errorText = await uploadResponse.text();
                                console.error('파일 업로드 실패 - 상태:', uploadResponse.status);
                                console.error('파일 업로드 실패 - 응답:', errorText);
                                throw new Error(`파일 업로드 실패: ${uploadResponse.status}`);
                            }
                        } catch (error) {
                            console.error('파일 업로드 오류:', error);
                            // API가 없는 경우 모의 처리
                            const mockFileId = `mock_file_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                            fileIds.push(mockFileId);
                            
                            // 모의 환경에서는 Data URL을 localStorage에 저장 (테스트용)
                            await new Promise((resolve) => {
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    const fileData = {
                                        file_id: mockFileId,
                                        original_filename: file.name,
                                        file_size: file.size,
                                        file_type: file.type,
                                        file_url: e.target.result,
                                        created_at: new Date().toISOString()
                                    };
                                    localStorage.setItem(`file_${mockFileId}`, JSON.stringify(fileData));
                                    console.log('모의 파일 저장됨:', mockFileId, fileData.original_filename);
                                    resolve();
                                };
                                reader.readAsDataURL(file);
                            });
                        }
                    }
                    
                    console.log('업로드된 파일 IDs:', fileIds);
                }
                
                btn.innerHTML = '<span class="loading"></span> 게시글 작성 중...';
                
                const postData = {
                    title: formData.get('title'),
                    content: formData.get('content'),
                    service: formData.get('service'),
                    metadata: {
                        type: formData.get('type'),
                        tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim().slice(0, 10)).slice(0, 3) : [],
                        visibility: 'public',
                        file_ids: fileIds // API 명세에 따라 file_ids 사용
                    }
                };
                
                console.log('Sending post data:', postData);
                
                const newPost = await createPost(postData);
                
                // 성공 시 파일 목록 초기화
                postUploadedFiles = [];
                updatePostFileList();
                form.reset();
                
                // 새로 작성된 게시글 상세 페이지로 이동
                if (newPost && (newPost.slug || newPost.id)) {
                    await showPostDetail(newPost.slug || newPost.id);
                } else {
                    showPage('posts');
                }
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '게시글 작성';
            }
        }
        
        // 댓글 관련
        async function loadComments(postSlug) {
            console.log('Loading comments for post:', postSlug);
            if (!postSlug) {
                console.warn('No post slug provided for loading comments');
                return;
            }
            
            try {
                const response = await apiCall(`/api/posts/${postSlug}/comments`);
                console.log('Comments loaded:', response);
                comments = response.comments || [];
                renderComments();
            } catch (error) {
                console.error('Failed to load comments:', error);
                comments = [];
                renderComments();
                showNotification('댓글을 불러오는데 실패했습니다.', 'error');
            }
        }

        function renderComments() {
            console.log('Rendering comments:', comments);
            const commentsList = document.getElementById('commentsList');
            if (!commentsList) {
                console.warn('commentsList element not found');
                return;
            }
            
            if (comments.length === 0) {
                commentsList.innerHTML = '<div class="no-comments">첫 번째 댓글을 작성해보세요!</div>';
            } else {
                commentsList.innerHTML = comments.map(comment => {
                    const commentId = comment._id || comment.id;
                    console.log('Rendering comment with ID:', commentId, 'Replies:', comment.replies);
                    
                    // 답글 렌더링
                    let repliesHtml = '';
                    if (comment.replies && comment.replies.length > 0) {
                        repliesHtml = `
                            <div class="replies-container">
                                ${comment.replies.map(reply => {
                                    const replyId = reply._id || reply.id;
                                    return `
                                        <div class="reply-item" data-comment-id="${replyId}">
                                            <div class="reply-author">${reply.author_id}</div>
                                            <div class="reply-content">${reply.content}</div>
                                            <div class="reply-meta">
                                                <span>${formatDate(reply.created_at)}</span>
                                                <span class="comment-like-btn" onclick="try{ toggleCommentReaction('${replyId}', 'like'); }catch(e){ console.error('Like error:', e); }" style="cursor: pointer;">👍 ${reply.like_count || 0}</span>
                                                <span class="comment-dislike-btn" onclick="try{ toggleCommentReaction('${replyId}', 'dislike'); }catch(e){ console.error('Dislike error:', e); }" style="cursor: pointer;">👎 ${reply.dislike_count || 0}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }
                    
                    return `
                    <div class="comment-item" data-comment-id="${commentId}">
                        <div class="comment-author">${comment.author_id}</div>
                        <div class="comment-content">${comment.content}</div>
                        <div class="comment-meta">
                            <span>${formatDate(comment.created_at)}</span>
                            <span class="comment-like-btn" onclick="try{ toggleCommentReaction('${commentId}', 'like'); }catch(e){ console.error('Like error:', e); }" style="cursor: pointer;">👍 ${comment.like_count || 0}</span>
                            <span class="comment-dislike-btn" onclick="try{ toggleCommentReaction('${commentId}', 'dislike'); }catch(e){ console.error('Dislike error:', e); }" style="cursor: pointer;">👎 ${comment.dislike_count || 0}</span>
                            <span style="cursor: pointer;" onclick="try{ replyToComment('${commentId}'); }catch(e){ console.error('Reply error:', e); }">답글 (${comment.reply_count || 0})</span>
                        </div>
                        ${repliesHtml}
                    </div>
                `;
                }).join('');
            }
            
            const commentCountElement = document.getElementById('commentCount');
            if (commentCountElement) {
                commentCountElement.textContent = comments.length;
            }
            
            console.log('Comments rendered, count:', comments.length);
        }
        
        async function addComment() {
            console.log('Adding comment...');
            console.log('Current user:', currentUser);
            console.log('Current post:', currentPost);
            
            if (!currentUser) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            const textarea = document.getElementById('commentTextarea');
            if (!textarea) {
                console.error('Comment textarea not found');
                showNotification('댓글 입력창을 찾을 수 없습니다.', 'error');
                return;
            }
            
            const content = textarea.value.trim();
            console.log('Comment content:', content);
            
            if (!content) {
                showNotification('댓글 내용을 입력해주세요.', 'error');
                return;
            }
            
            try {
                console.log('Sending comment to API...');
                const response = await apiCall(`/api/posts/${currentPost.slug}/comments`, {
                    method: 'POST',
                    body: JSON.stringify({ content: content })
                });
                
                console.log('Comment created:', response);
                
                // 댓글 목록 새로고침
                await loadComments(currentPost.slug);
                textarea.value = '';
                
                showNotification('댓글이 추가되었습니다!', 'success');
            } catch (error) {
                console.error('Failed to add comment:', error);
                showNotification(error.message || '댓글 추가에 실패했습니다.', 'error');
            }
        }

        // 게시글 좋아요/싫어요 기능
        async function togglePostReaction(postSlug, type) {
            console.log('Toggle post reaction:', postSlug, type);
            
            if (!currentUser) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            try {
                // 실제 API 호출
                const endpoint = type === 'like' ? 'like' : 'dislike';
                const response = await apiCall(`/api/posts/${postSlug}/${endpoint}`, {
                    method: 'POST'
                });
                
                console.log('Post reaction API response:', response);
                
                // 게시글 목록 새로고침하여 최신 상태 반영
                await loadPosts();
                
                showNotification(`게시글에 ${type === 'like' ? '좋아요' : '싫어요'}를 눌렀습니다.`, 'success');
                
            } catch (error) {
                console.error('Failed to toggle post reaction:', error);
                showNotification(error.message || '반응 처리에 실패했습니다.', 'error');
            }
        }

        // 댓글 좋아요/싫어요 기능
        async function toggleCommentReaction(commentId, type) {
            console.log('Toggle comment reaction:', commentId, type);
            
            if (!currentUser) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            try {
                // 실제 API 호출
                const endpoint = type === 'like' ? 'like' : 'dislike';
                const response = await apiCall(`/api/posts/${currentPost.slug}/comments/${commentId}/${endpoint}`, {
                    method: 'POST'
                });
                
                console.log('Reaction API response:', response);
                
                // 댓글 목록 새로고침하여 최신 상태 반영
                await loadComments(currentPost.slug);
                
                showNotification(`댓글에 ${type === 'like' ? '좋아요' : '싫어요'}를 눌렀습니다.`, 'success');
                
            } catch (error) {
                console.error('Failed to toggle comment reaction:', error);
                showNotification(error.message || '반응 처리에 실패했습니다.', 'error');
            }
        }

        // 댓글 답글 기능
        function replyToComment(commentId) {
            console.log('Reply to comment:', commentId);
            
            if (!currentUser) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            // 기존 답글 폼이 있으면 제거
            const existingReplyForm = document.querySelector('.reply-form');
            if (existingReplyForm) {
                existingReplyForm.remove();
            }
            
            // 해당 댓글 찾기
            const commentElement = document.querySelector(`[data-comment-id="${commentId}"]`);
            if (!commentElement) {
                console.error('Comment element not found for ID:', commentId);
                return;
            }
            
            // 답글 입력 폼 생성
            const replyForm = document.createElement('div');
            replyForm.className = 'reply-form';
            replyForm.innerHTML = `
                <div class="reply-form-content">
                    <textarea class="reply-textarea" placeholder="답글을 작성해주세요..." rows="3"></textarea>
                    <div class="reply-actions">
                        <button class="btn-reply-submit" onclick="submitReply('${commentId}')">답글 작성</button>
                        <button class="btn-reply-cancel" onclick="cancelReply()">취소</button>
                    </div>
                </div>
            `;
            
            // 댓글 아래에 답글 폼 추가
            commentElement.appendChild(replyForm);
            
            // 답글 입력창에 포커스
            const textarea = replyForm.querySelector('.reply-textarea');
            textarea.focus();
        }
        
        // 답글 작성 제출
        async function submitReply(parentCommentId) {
            console.log('Submit reply to comment:', parentCommentId);
            
            const replyForm = document.querySelector('.reply-form');
            if (!replyForm) return;
            
            const textarea = replyForm.querySelector('.reply-textarea');
            const content = textarea.value.trim();
            
            if (!content) {
                showNotification('답글 내용을 입력해주세요.', 'error');
                return;
            }
            
            try {
                console.log('Sending reply to API...');
                const response = await apiCall(`/api/posts/${currentPost.slug}/comments/${parentCommentId}/replies`, {
                    method: 'POST',
                    body: JSON.stringify({ content: content })
                });
                
                console.log('Reply created:', response);
                
                // 답글 폼 제거
                replyForm.remove();
                
                // 댓글 목록 새로고침
                await loadComments(currentPost.slug);
                
                showNotification('답글이 추가되었습니다!', 'success');
                
            } catch (error) {
                console.error('Failed to submit reply:', error);
                showNotification(error.message || '답글 작성에 실패했습니다.', 'error');
            }
        }
        
        // 답글 작성 취소
        function cancelReply() {
            const replyForm = document.querySelector('.reply-form');
            if (replyForm) {
                replyForm.remove();
            }
        }

        
        // 반응 관련
        async function toggleReaction(type) {
            if (!currentUser) {
                showNotification('로그인이 필요합니다.', 'error');
                showPage('login');
                return;
            }
            
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            try {
                // 실제 API 호출
                const endpoint = type === 'like' ? 'like' : type === 'dislike' ? 'dislike' : 'bookmark';
                const response = await apiCall(`/api/posts/${currentPost.slug}/${endpoint}`, {
                    method: 'POST'
                });
                
                console.log('Post detail reaction API response:', response);
                
                // UI 업데이트
                const countElement = document.getElementById(type + 'Count');
                if (type === 'like') {
                    countElement.textContent = response.like_count;
                    document.getElementById('likeCount').textContent = response.like_count;
                    document.getElementById('dislikeCount').textContent = response.dislike_count;
                } else if (type === 'dislike') {
                    countElement.textContent = response.dislike_count;
                    document.getElementById('likeCount').textContent = response.like_count;
                    document.getElementById('dislikeCount').textContent = response.dislike_count;
                } else if (type === 'bookmark') {
                    countElement.textContent = response.bookmark_count;
                }
                
                // 버튼 스타일 업데이트
                const likeBtn = document.getElementById('likeCount').closest('.reaction-btn');
                const dislikeBtn = document.getElementById('dislikeCount').closest('.reaction-btn');
                const bookmarkBtn = document.getElementById('bookmarkCount').closest('.reaction-btn');
                
                // Like/Dislike 버튼 스타일 업데이트 (user_reaction이 있는 경우에만)
                if (response.user_reaction) {
                    if (response.user_reaction.liked) {
                        likeBtn.classList.add('active');
                    } else {
                        likeBtn.classList.remove('active');
                    }
                    
                    if (response.user_reaction.disliked) {
                        dislikeBtn.classList.add('active');
                    } else {
                        dislikeBtn.classList.remove('active');
                    }
                    
                    if (response.user_reaction.bookmarked) {
                        bookmarkBtn.classList.add('active');
                    } else {
                        bookmarkBtn.classList.remove('active');
                    }
                }
                
                let message = '';
                if (type === 'like') {
                    message = `게시글에 좋아요를 눌렀습니다.`;
                } else if (type === 'dislike') {
                    message = `게시글에 싫어요를 눌렀습니다.`;
                } else if (type === 'bookmark') {
                    message = response.action === 'bookmarked' ? '북마크에 추가했습니다.' : '북마크를 제거했습니다.';
                }
                showNotification(message, 'success');
                
            } catch (error) {
                console.error('Failed to toggle reaction:', error);
                showNotification(error.message || '반응 처리에 실패했습니다.', 'error');
            }
        }
        
        // 서비스별 타입 업데이트
        function updateTypeFilter() {
            const serviceFilter = document.getElementById('serviceFilter');
            const typeFilter = document.getElementById('typeFilter');
            const selectedService = serviceFilter.value;
            
            // 타입 옵션 초기화
            typeFilter.innerHTML = '<option value="">전체</option>';
            
            // 선택된 서비스의 타입들 추가
            if (selectedService && serviceTypes[selectedService]) {
                serviceTypes[selectedService].forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeFilter.appendChild(option);
                });
            }
            
            // 필터 적용
            filterPosts();
        }
        
        // 게시글 작성 폼의 타입 업데이트
        function updateCreatePostType() {
            const serviceSelect = document.getElementById('createPostService');
            const typeSelect = document.getElementById('createPostType');
            const selectedService = serviceSelect.value;
            
            // 타입 옵션 초기화
            typeSelect.innerHTML = '';
            
            // 선택된 서비스의 타입들 추가
            if (selectedService && serviceTypes[selectedService]) {
                serviceTypes[selectedService].forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeSelect.appendChild(option);
                });
            }
        }
        
        // 필터링 및 검색
        function filterPosts() {
            const serviceFilter = document.getElementById('serviceFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const searchInput = document.getElementById('searchInput');
            const searchQuery = searchInput ? searchInput.value.trim() : '';
            
            // 전체 posts 데이터에서 필터링 시작 (API 로드된 데이터 사용)
            let filteredPosts = [...(window.allPosts || posts)];
            
            // 서비스 필터
            if (serviceFilter) {
                filteredPosts = filteredPosts.filter(post => post.service === serviceFilter);
            }
            
            // 타입 필터
            if (typeFilter) {
                filteredPosts = filteredPosts.filter(post => post.metadata?.type === typeFilter);
            }
            
            // 검색어 필터
            if (searchQuery) {
                filteredPosts = filteredPosts.filter(post => 
                    post.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    post.content.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (post.metadata?.tags || []).some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
                );
            }
            
            posts = filteredPosts;
            renderPosts();
        }
        
        function sortPosts() {
            const select = event.target;
            const sortBy = select.value;
            
            posts.sort((a, b) => {
                if (sortBy === 'created_at') {
                    return new Date(b.created_at) - new Date(a.created_at);
                } else if (sortBy === 'views') {
                    return ((b.stats?.view_count || b.view_count) || 0) - ((a.stats?.view_count || a.view_count) || 0);
                } else if (sortBy === 'likes') {
                    return ((b.stats?.like_count || b.like_count) || 0) - ((a.stats?.like_count || a.like_count) || 0);
                }
                return 0;
            });
            
            renderPosts();
        }
        
        function searchPosts(query) {
            const serviceFilter = document.getElementById('serviceFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            
            // API에서 로드된 posts 데이터 사용 (mockPosts 대신)
            let filteredPosts = [...posts];
            
            // 먼저 서비스/타입 필터 적용
            if (serviceFilter) {
                filteredPosts = filteredPosts.filter(post => post.service === serviceFilter);
            }
            if (typeFilter) {
                filteredPosts = filteredPosts.filter(post => post.metadata?.type === typeFilter);
            }
            
            // 검색어 필터 (제목과 내용에 대해서만)
            if (query.trim()) {
                filteredPosts = filteredPosts.filter(post => 
                    post.title.toLowerCase().includes(query.toLowerCase()) ||
                    post.content.toLowerCase().includes(query.toLowerCase()) ||
                    (post.metadata?.tags || []).some(tag => tag.toLowerCase().includes(query.toLowerCase()))
                );
            }
            
            // 검색 결과를 posts에 할당하여 렌더링
            const originalPosts = [...posts]; // 원본 데이터 백업
            posts = filteredPosts;
            renderPosts();
            
            // 검색이 끝나고 다시 원본 데이터로 복원하지 않음 (사용자가 필터를 해제할 때까지)
        }
        
        // API 테스트 관련 함수들
        function toggleApiTest(element) {
            const toggle = element.querySelector('.endpoint-toggle');
            const panel = element.parentElement.querySelector('.api-test-panel');
            
            const isExpanded = panel.classList.contains('expanded');
            
            if (isExpanded) {
                panel.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.textContent = '▶';
            } else {
                panel.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.textContent = '▼';
            }
        }
        
        async function testApiCall(button, method, endpoint) {
            console.log('=== API Call Started ===');
            console.log('Method:', method, 'Endpoint:', endpoint);
            
            const panel = button.closest('.test-panel-content');
            const form = panel.querySelector('.test-form');
            const responseSection = panel.querySelector('.api-response-section');
            const responseContent = panel.querySelector('.response-content pre');
            
            // 버튼 로딩 상태
            const originalText = button.textContent;
            button.textContent = '⏳ 요청중...';
            button.disabled = true;
            
            try {
                let requestData = {};
                
                // 로그인 API의 경우 직접 데이터 수집
                if (endpoint === '/auth/login') {
                    const emailInput = form.querySelector('input[type="email"]');
                    const passwordInput = form.querySelector('input[type="password"]');
                    
                    console.log('Email input:', emailInput ? emailInput.value : 'not found');
                    console.log('Password input:', passwordInput ? passwordInput.value : 'not found');
                    
                    const email = emailInput ? emailInput.value.trim() : '';
                    const password = passwordInput ? passwordInput.value.trim() : '';
                    
                    if (!email || !password) {
                        throw new Error('이메일과 비밀번호를 모두 입력해주세요.');
                    }
                    
                    // OAuth2 표준 FormData 형식
                    const formData = new FormData();
                    formData.append('username', email);  // OAuth2에서는 username 필드 사용
                    formData.append('password', password);
                    
                    console.log('Login FormData created:', { username: email, password: '***' });
                    
                    const response = await fetch(`http://localhost:8000${endpoint}`, {
                        method: 'POST',
                        body: formData  // FormData는 Content-Type 헤더를 자동으로 설정
                    });
                    
                    console.log('Response status:', response.status);
                    const data = await response.json();
                    console.log('Response data:', data);
                    
                    const apiResponse = {
                        status: response.status,
                        statusText: response.statusText,
                        data: data,
                        timestamp: new Date().toISOString()
                    };
                    
                    // 응답 표시
                    responseContent.textContent = JSON.stringify(apiResponse, null, 2);
                    responseSection.style.display = 'block';
                    
                    if (response.ok) {
                        showNotification('로그인 API 테스트 성공!', 'success');
                        
                        // 로그인 성공 시 토큰 저장
                        if (data.access_token) {
                            localStorage.setItem('authToken', data.access_token);
                            currentUser = data.user || { email: email };
                            updateAuthUI();
                        }
                    } else {
                        showNotification(`로그인 API 테스트 실패: ${data.detail || '알 수 없는 오류'}`, 'error');
                    }
                    
                } else {
                    // 다른 API들을 위한 기존 로직
                    const formData = {};
                    const inputs = form.querySelectorAll('input, textarea, select');
                    
                    inputs.forEach(input => {
                        if (input.value && !input.placeholder.includes('Bearer')) {
                            const labelElement = input.previousElementSibling;
                            const labelText = labelElement ? labelElement.textContent.trim() : '';
                            let key = '';
                            
                            switch(labelText) {
                                case '제목': key = 'title'; break;
                                case '내용': key = 'content'; break;
                                case '서비스': key = 'service'; break;
                                case '페이지': key = 'page'; break;
                                case '개수': key = 'limit'; break;
                                case '타입 (선택)':
                                case '타입': key = 'type'; break;
                                case '게시글 Slug': key = 'slug'; break;
                                default:
                                    key = labelText.toLowerCase().replace(/[^a-z0-9]/g, '_');
                            }
                            
                            if (key) {
                                formData[key] = input.value.trim();
                            }
                        }
                    });
                    
                    const headers = { 'Content-Type': 'application/json' };
                    
                    // Authorization 헤더 처리
                    const authInput = form.querySelector('input[placeholder*="Bearer"]');
                    if (authInput && authInput.value) {
                        headers['Authorization'] = authInput.value;
                    }
                    
                    let response;
                    const apiUrl = `http://localhost:8000${endpoint}`;
                    
                    if (method === 'GET') {
                        const params = new URLSearchParams(formData);
                        response = await fetch(`${apiUrl}?${params}`, {
                            method: 'GET',
                            headers: headers
                        });
                    } else {
                        response = await fetch(apiUrl, {
                            method: method,
                            headers: headers,
                            body: JSON.stringify(formData)
                        });
                    }
                    
                    const data = await response.json();
                    const apiResponse = {
                        status: response.status,
                        statusText: response.statusText,
                        data: data,
                        timestamp: new Date().toISOString()
                    };
                    
                    responseContent.textContent = JSON.stringify(apiResponse, null, 2);
                    responseSection.style.display = 'block';
                    
                    if (response.ok) {
                        showNotification(`${endpoint} API 테스트 성공!`, 'success');
                    } else {
                        showNotification(`${endpoint} API 테스트 실패: ${data.detail || '알 수 없는 오류'}`, 'error');
                    }
                }
                
                // 응답 섹션으로 스크롤
                setTimeout(() => {
                    responseSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
                
            } catch (error) {
                console.error('API Call Error:', error);
                
                const errorResponse = {
                    error: "API 호출 실패",
                    message: error.message,
                    timestamp: new Date().toISOString()
                };
                
                responseContent.textContent = JSON.stringify(errorResponse, null, 2);
                responseSection.style.display = 'block';
                
                showNotification(`API 테스트 실패: ${error.message}`, 'error');
                
                setTimeout(() => {
                    responseSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            } finally {
                // 버튼 복원
                button.textContent = originalText;
                button.disabled = false;
                console.log('=== API Call Ended ===');
            }
        }
        
        function clearApiForm(button) {
            const form = button.closest('.test-form');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'number') {
                    input.value = input.placeholder || '1';
                } else if (input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                } else {
                    input.value = '';
                }
            });
            
            const responseSection = button.closest('.test-panel-content').querySelector('.api-response-section');
            if (responseSection) {
                responseSection.style.display = 'none';
                const responseContent = responseSection.querySelector('.response-content pre');
                if (responseContent) {
                    responseContent.textContent = '응답 대기중...';
                }
            }
        }
        
        // 응답 탭 전환 (API 테스트용)
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('response-tab')) {
                const tabs = e.target.parentElement.querySelectorAll('.response-tab');
                tabs.forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                
                const content = e.target.closest('.api-response-section').querySelector('.response-content pre');
                if (e.target.textContent === '헤더') {
                    content.textContent = JSON.stringify({
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer token...',
                        'User-Agent': 'FastAPI-Dashboard/1.0',
                        'Accept': 'application/json'
                    }, null, 2);
                } else if (e.target.textContent === '요청') {
                    content.textContent = JSON.stringify({
                        method: 'POST',
                        url: '/api/endpoint',
                        headers: {'Content-Type': 'application/json'},
                        body: {'test': 'data'}
                    }, null, 2);
                }
            }
        });
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modalOverlay').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }
        
        // 모달 배경 클릭 시 닫기
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // 로그인 API 호출 함수
        async function testApiCallNew(button, method, endpoint) {
            const originalText = button.textContent;
            button.textContent = '⏳ 로그인 중...';
            button.disabled = true;
            
            try {
                // 로그인 데이터 수집
                const formData = new FormData();
                formData.append('username', 'test@test.com');
                formData.append('password', 'password123');
                
                const response = await fetch('http://localhost:8000/auth/login', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                // 응답 표시
                const responseSection = button.closest('.test-panel-content').querySelector('.api-response-section');
                const responseContent = responseSection.querySelector('.response-content pre');
                
                const apiResponse = {
                    status: response.status,
                    statusText: response.statusText,
                    data: data,
                    timestamp: new Date().toISOString()
                };
                
                responseContent.textContent = JSON.stringify(apiResponse, null, 2);
                responseSection.style.display = 'block';
                
                if (response.ok) {
                    showNotification('로그인 성공!', 'success');
                    
                    // 로그인 성공 시 토큰 저장
                    if (data.access_token) {
                        localStorage.setItem('authToken', data.access_token);
                        currentUser = data.user || { email: 'test@test.com' };
                        updateAuthUI();
                    }
                } else {
                    showNotification('로그인 실패: ' + (data.detail || '알 수 없는 오류'), 'error');
                }
                
                // 응답 섹션으로 스크롤
                setTimeout(() => {
                    responseSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
                
            } catch (error) {
                const errorResponse = {
                    error: "API 호출 실패",
                    message: error.message,
                    timestamp: new Date().toISOString()
                };
                
                const responseSection = button.closest('.test-panel-content').querySelector('.api-response-section');
                const responseContent = responseSection.querySelector('.response-content pre');
                responseContent.textContent = JSON.stringify(errorResponse, null, 2);
                responseSection.style.display = 'block';
                
                showNotification('API 호출 오류: ' + error.message, 'error');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 로그인 API 버튼 이벤트 리스너 추가
            const loginButton = document.getElementById('loginApiButton');
            if (loginButton) {
                loginButton.addEventListener('click', function() {
                    const method = this.dataset.method;
                    const endpoint = this.dataset.endpoint;
                    testApiCallNew(this, method, endpoint);
                });
            }
            
            init();
        });
        
        // 모바일 사이드바 토글
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        // 창 크기 변경 시 사이드바 자동 닫기
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        });
        
        // =========================
        // 게시글 수정/삭제 기능
        // =========================
        
        // 게시글 수정 버튼 클릭
        function editCurrentPost() {
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            // 수정 폼에 기존 데이터 채우기
            document.getElementById('editPostTitle').value = currentPost.title || '';
            document.getElementById('editPostContent').value = currentPost.content || '';
            document.getElementById('editPostService').value = currentPost.service || '';
            
            // 서비스에 따른 타입 옵션 업데이트
            updateEditPostType();
            document.getElementById('editPostType').value = currentPost.metadata?.type || '';
            
            // 태그 설정
            const tags = currentPost.metadata?.tags || [];
            document.getElementById('editPostTags').value = tags.join(', ');
            
            // 수정 페이지로 이동
            showPage('post-edit');
        }
        
        // 게시글 삭제 버튼 클릭
        function deleteCurrentPost() {
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            // 삭제 확인 다이얼로그 표시
            document.getElementById('deleteConfirmDialog').classList.add('active');
        }
        
        // 삭제 확인
        async function confirmDeletePost() {
            if (!currentPost) return;
            
            try {
                await apiCall(`/api/posts/${currentPost.slug}`, {
                    method: 'DELETE'
                });
                
                showNotification('게시글이 삭제되었습니다.', 'success');
                
                // 다이얼로그 닫기
                document.getElementById('deleteConfirmDialog').classList.remove('active');
                
                // 게시글 목록으로 이동
                showPage('posts');
                
                // 게시글 목록 새로고침
                await loadPosts();
                
            } catch (error) {
                console.error('Failed to delete post:', error);
                showNotification('게시글 삭제에 실패했습니다.', 'error');
            }
        }
        
        // 삭제 취소
        function cancelDeletePost() {
            document.getElementById('deleteConfirmDialog').classList.remove('active');
        }
        
        // 게시글 수정 제출
        async function handleUpdatePost(event) {
            event.preventDefault();
            
            if (!currentPost) {
                showNotification('게시글 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            const btn = document.getElementById('updatePostBtn');
            const form = event.target;
            const formData = new FormData(form);
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> 수정 중...';
            
            try {
                const updateData = {
                    title: formData.get('title'),
                    content: formData.get('content'),
                    service: formData.get('service'),
                    metadata: {
                        type: formData.get('type'),
                        tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim().slice(0, 10)).slice(0, 3) : [],
                        visibility: 'public'
                    }
                };
                
                console.log('Updating post with data:', updateData);
                
                const updatedPost = await apiCall(`/api/posts/${currentPost.slug}`, {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                showNotification('게시글이 성공적으로 수정되었습니다!', 'success');
                
                // 현재 게시글 정보 업데이트
                currentPost = updatedPost;
                window.currentPost = updatedPost;
                
                // 게시글 상세 페이지로 이동하여 업데이트된 내용 표시
                await showPostDetail(updatedPost.slug || updatedPost.id);
                
            } catch (error) {
                console.error('Failed to update post:', error);
                showNotification('게시글 수정에 실패했습니다.', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '수정 완료';
            }
        }
        
        // 수정 폼의 서비스별 타입 업데이트
        function updateEditPostType() {
            const serviceSelect = document.getElementById('editPostService');
            const typeSelect = document.getElementById('editPostType');
            const selectedService = serviceSelect.value;
            
            // 타입 옵션 초기화
            typeSelect.innerHTML = '<option value="">타입 선택</option>';
            
            // 선택된 서비스의 타입들 추가
            if (selectedService && serviceTypes[selectedService]) {
                serviceTypes[selectedService].forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeSelect.appendChild(option);
                });
            }
        }
        
        // 작성자 권한 체크 및 UI 업데이트
        function updatePostActions() {
            console.log('=== 게시글 수정/삭제 버튼 권한 체크 ===');
            const postActions = document.getElementById('postActions');
            
            if (!postActions) {
                console.error('❌ postActions 요소를 찾을 수 없습니다!');
                return;
            }
            
            // 로그인 상태 및 현재 게시글 체크
            if (!currentUser) {
                console.log('❌ 로그인되지 않음 - 버튼 숨김');
                postActions.style.display = 'none';
                return;
            }
            
            if (!currentPost) {
                console.log('❌ 게시글 데이터 없음 - 버튼 숨김');
                postActions.style.display = 'none';
                return;
            }
            
            // 사용자와 작성자 정보 비교
            const userEmail = currentUser.email;
            const userHandle = currentUser.user_handle;
            const postAuthor = currentPost.author_id;
            
            console.log('현재 사용자:', userEmail);
            console.log('게시글 작성자:', postAuthor);
            
            // 작성자 체크 (User ID로 비교)
            const userId = currentUser._id || currentUser.id;
            const isAuthor = userId === postAuthor || userEmail === postAuthor || userHandle === postAuthor;
            
            console.log('User ID:', userId);
            console.log('비교:', {
                'ID 매치': userId === postAuthor,
                '이메일 매치': userEmail === postAuthor,
                '핸들 매치': userHandle === postAuthor
            });
            
            console.log('작성자 여부:', isAuthor);
            console.log('비교 결과:', {
                '이메일 매치': userEmail === postAuthor,
                '핸들 매치': userHandle === postAuthor
            });
            
            if (isAuthor) {
                console.log('✅ 작성자 확인! 수정/삭제 버튼 표시');
                postActions.style.display = 'flex';
            } else {
                console.log('❌ 작성자가 아님. 버튼 숨김');
                postActions.style.display = 'none';
            }
        }
        
        // ====== 새로운 게시글 파일 업로드 관련 함수들 ======
        let postUploadedFiles = [];
        
        // 게시글 작성 파일 업로드 초기화
        function initPostFileUpload() {
            const uploadArea = document.getElementById('postFileUpload');
            const fileInput = document.getElementById('postFileInput');
            const fileList = document.getElementById('postFileList');
            const uploadedFilesContainer = document.getElementById('postUploadedFiles');
            
            if (!uploadArea || !fileInput) return;
            
            // 클릭 이벤트
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // 파일 선택 이벤트
            fileInput.addEventListener('change', handlePostFileSelect);
            
            // 드래그 앤 드롭 이벤트
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handlePostFileSelect({ target: { files } });
                }
            });
        }
        
        function handlePostFileSelect(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            // 이미지 파일만 필터링
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showNotification('이미지 파일만 업로드 가능합니다.', 'error');
                return;
            }
            
            // 파일 크기 체크 (10MB 제한)
            const maxSize = 10 * 1024 * 1024; // 10MB
            const oversizedFiles = imageFiles.filter(file => file.size > maxSize);
            
            if (oversizedFiles.length > 0) {
                showNotification('파일 크기는 10MB를 초과할 수 없습니다.', 'error');
                return;
            }
            
            // 파일들을 postUploadedFiles에 추가
            imageFiles.forEach(file => {
                if (!postUploadedFiles.find(f => f.name === file.name && f.size === file.size)) {
                    postUploadedFiles.push(file);
                }
            });
            
            updatePostFileList();
        }
        
        function updatePostFileList() {
            const fileList = document.getElementById('postFileList');
            const uploadedFilesContainer = document.getElementById('postUploadedFiles');
            
            if (postUploadedFiles.length === 0) {
                uploadedFilesContainer.style.display = 'none';
                return;
            }
            
            uploadedFilesContainer.style.display = 'block';
            fileList.innerHTML = '';
            
            postUploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                // 이미지 미리보기 생성
                const reader = new FileReader();
                reader.onload = (e) => {
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <img src="${e.target.result}" alt="미리보기" class="file-preview">
                            <div class="file-details">
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <button type="button" class="file-remove" onclick="removePostFile(${index})">
                            삭제
                        </button>
                    `;
                };
                reader.readAsDataURL(file);
                
                fileList.appendChild(fileItem);
            });
        }
        
        function removePostFile(index) {
            postUploadedFiles.splice(index, 1);
            updatePostFileList();
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 게시글 상세에서 첨부 파일 표시
        async function displayPostAttachments(fileIds) {
            console.log('=== 첨부 파일 표시 함수 호출 ===');
            console.log('전달받은 file IDs:', fileIds);
            
            const attachmentsContainer = document.getElementById('postAttachments');
            const attachmentsGrid = document.getElementById('attachmentsGrid');
            
            if (!attachmentsContainer || !attachmentsGrid) {
                console.error('첨부 파일 컨테이너 요소를 찾을 수 없습니다');
                return;
            }
            
            if (!fileIds || fileIds.length === 0) {
                console.log('첨부 파일이 없어 컨테이너를 숨깁니다');
                attachmentsContainer.style.display = 'none';
                return;
            }
            
            console.log(`${fileIds.length}개의 첨부 파일을 표시합니다`);
            attachmentsContainer.style.display = 'block';
            attachmentsGrid.innerHTML = '';
            
            for (let i = 0; i < fileIds.length; i++) {
                const fileId = fileIds[i];
                console.log(`파일 ${i + 1} ID:`, fileId);
                
                const attachmentItem = document.createElement('div');
                attachmentItem.className = 'attachment-item';
                
                // API 명세에 따른 이미지 URL
                let imageUrl = `${API_BASE_URL}/api/files/${fileId}`;
                let fileName = `이미지 ${i + 1}`;
                let fileSize = 0;
                
                // 모의 파일인 경우 localStorage에서 정보 가져오기
                if (fileId.startsWith('mock_file_')) {
                    const storedFileData = localStorage.getItem(`file_${fileId}`);
                    if (storedFileData) {
                        try {
                            const fileData = JSON.parse(storedFileData);
                            imageUrl = fileData.file_url; // Data URL
                            fileName = fileData.original_filename || fileName;
                            fileSize = fileData.file_size || 0;
                            console.log('모의 파일 데이터 로드:', fileData);
                        } catch (e) {
                            console.error('모의 파일 데이터 파싱 실패:', e);
                        }
                    }
                } else {
                    // 실제 파일인 경우 메타데이터 조회 시도
                    try {
                        const metaResponse = await fetch(`${API_BASE_URL}/api/files/${fileId}/info`);
                        if (metaResponse.ok) {
                            const metaData = await metaResponse.json();
                            fileName = metaData.original_filename || fileName;
                            fileSize = metaData.file_size || 0;
                        }
                    } catch (error) {
                        console.log('파일 메타데이터 조회 실패 (정상):', error);
                    }
                }
                
                console.log(`이미지 URL: ${imageUrl}`);
                console.log(`파일명: ${fileName}`);
                
                attachmentItem.innerHTML = `
                    <img src="${imageUrl}" alt="${fileName}" class="attachment-image" 
                         onclick="openImageModal('${imageUrl.replace(/'/g, '&#39;')}')" 
                         onerror="console.error('이미지 로드 실패:', '${fileName}'); this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'100\\' height=\\'100\\' viewBox=\\'0 0 100 100\\'%3E%3Crect width=\\'100\\' height=\\'100\\' fill=\\'%23f0f0f0\\'/%3E%3Ctext x=\\'50\\' y=\\'50\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\' font-family=\\'sans-serif\\' font-size=\\'14\\'%3E이미지 없음%3C/text%3E%3C/svg%3E';"
                         onload="console.log('이미지 로드 성공:', '${fileName}')">
                    <div class="attachment-info">
                        <div class="attachment-name">${fileName}</div>
                        <div class="attachment-size">${formatFileSize(fileSize)}</div>
                    </div>
                `;
                
                attachmentsGrid.appendChild(attachmentItem);
            }
        }
        
        // 이미지 모달 열기
        function openImageModal(imageUrl) {
            // 모달이 없으면 동적 생성
            let modal = document.getElementById('imageModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'imageModal';
                modal.className = 'image-modal';
                modal.innerHTML = `
                    <button class="modal-close" onclick="closeImageModal()">&times;</button>
                    <img src="" alt="이미지" class="modal-image" id="modalImage">
                `;
                document.body.appendChild(modal);
                
                // 모달 배경 클릭 시 닫기
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeImageModal();
                    }
                });
                
                // ESC 키로 닫기
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        closeImageModal();
                    }
                });
            }
            
            document.getElementById('modalImage').src = imageUrl;
            modal.classList.add('active');
        }
        
        // 이미지 모달 닫기
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        // ====== 기존 파일 업로드 관련 함수들 ======
        let selectedFile = null;
        
        function logApi(message, type = 'info') {
            const apiLog = document.getElementById('apiLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '5px';
            logEntry.style.color = type === 'error' ? '#dc2626' : type === 'success' ? '#059669' : '#374151';
            logEntry.innerHTML = `<span style="color: #6b7280;">[${timestamp}]</span> ${message}`;
            apiLog.appendChild(logEntry);
            apiLog.scrollTop = apiLog.scrollHeight;
        }
        
        function clearApiLog() {
            const apiLog = document.getElementById('apiLog');
            apiLog.innerHTML = '<div style="color: #6b7280;">API 호출 로그가 여기에 표시됩니다...</div>';
        }
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            selectedFile = file;
            logApi(`📁 파일 선택됨: ${file.name} (${formatFileSize(file.size)})`);
            
            // 파일 정보 표시
            document.getElementById('fileDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em;">
                    <div><strong>파일명:</strong> ${file.name}</div>
                    <div><strong>크기:</strong> ${formatFileSize(file.size)}</div>
                    <div><strong>타입:</strong> ${file.type}</div>
                    <div><strong>마지막 수정:</strong> ${new Date(file.lastModified).toLocaleDateString()}</div>
                </div>
            `;
            
            document.getElementById('fileInfo').style.display = 'block';
            document.getElementById('uploadArea').style.borderColor = '#10b981';
            document.getElementById('uploadArea').style.backgroundColor = '#f0fdf4';
            
            // 다른 상태 숨기기
            hideAllUploadStates();
        }
        
        function clearFileSelection() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('uploadArea').style.borderColor = '#d1d5db';
            document.getElementById('uploadArea').style.backgroundColor = 'transparent';
            hideAllUploadStates();
            logApi('❌ 파일 선택 취소됨');
        }
        
        function hideAllUploadStates() {
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadResult').style.display = 'none';
            document.getElementById('uploadError').style.display = 'none';
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        async function uploadSelectedFile() {
            if (!selectedFile) {
                logApi('⚠️ 업로드할 파일이 선택되지 않았습니다.', 'error');
                return;
            }
            
            // UI 상태 업데이트
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('uploadProgress').style.display = 'block';
            hideAllUploadStates();
            document.getElementById('uploadProgress').style.display = 'block';
            
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            
            try {
                logApi(`🚀 업로드 시작: ${selectedFile.name}`);
                
                // FormData 생성
                const formData = new FormData();
                formData.append('file', selectedFile);
                
                // 첨부 정보 추가 (선택사항)
                const attachmentType = document.getElementById('attachmentType').value;
                const attachmentId = document.getElementById('attachmentId').value;
                
                if (attachmentType) {
                    formData.append('attachment_type', attachmentType);
                    logApi(`📎 첨부 타입: ${attachmentType}`);
                }
                if (attachmentId) {
                    formData.append('attachment_id', attachmentId);
                    logApi(`🔗 첨부 ID: ${attachmentId}`);
                }
                
                // 진행상황 시뮬레이션
                updateProgress(0, '업로드 준비 중...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                updateProgress(25, '파일 검증 중...');
                await new Promise(resolve => setTimeout(resolve, 300));
                
                updateProgress(50, '서버에 업로드 중...');
                
                // API 호출
                const response = await fetch(`${API_BASE_URL}/api/files/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                updateProgress(75, '서버 응답 처리 중...');
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const result = await response.json();
                
                updateProgress(100, '업로드 완료!');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (response.ok) {
                    // 성공 처리
                    logApi(`✅ 업로드 성공! 파일 ID: ${result.file_id}`, 'success');
                    showUploadSuccess(result);
                } else {
                    // 오류 처리
                    logApi(`❌ 업로드 실패: ${result.detail || '알 수 없는 오류'}`, 'error');
                    showUploadError(result.detail || '알 수 없는 오류가 발생했습니다.');
                }
                
            } catch (error) {
                logApi(`💥 네트워크 오류: ${error.message}`, 'error');
                showUploadError(`네트워크 오류: ${error.message}`);
            } finally {
                document.getElementById('uploadProgress').style.display = 'none';
                uploadBtn.disabled = false;
            }
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        function showUploadSuccess(result) {
            document.getElementById('uploadResult').style.display = 'block';
            document.getElementById('resultDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9em;">
                    <div><strong>파일 ID:</strong><br><code style="background: #e5e7eb; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">${result.file_id}</code></div>
                    <div><strong>파일명:</strong><br>${result.filename}</div>
                    <div><strong>파일 경로:</strong><br><code style="background: #e5e7eb; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">${result.file_path}</code></div>
                    <div><strong>파일 크기:</strong><br>${formatFileSize(result.file_size)}</div>
                    <div><strong>MIME 타입:</strong><br>${result.content_type}</div>
                    <div><strong>상태:</strong><br><span style="color: #059669;">✅ 업로드 완료</span></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #ecfdf5; border-radius: 6px;">
                    <strong>🎉 모든 검증 단계를 통과했습니다!</strong>
                    <ul style="margin: 10px 0; padding-left: 20px; color: #059669;">
                        <li>파일 타입 검증 ✅</li>
                        <li>파일 크기 검증 ✅</li>
                        <li>확장자 일치성 검증 ✅</li>
                        <li>디스크 저장 ✅</li>
                        <li>데이터베이스 저장 ✅</li>
                    </ul>
                </div>
            `;
        }
        
        function showUploadError(message) {
            document.getElementById('uploadError').style.display = 'block';
            document.getElementById('errorDetails').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>오류 메시지:</strong><br>
                    ${message}
                </div>
                <div style="font-size: 0.9em; color: #7f1d1d;">
                    <strong>문제 해결 방법:</strong>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>파일이 이미지 형식인지 확인 (JPG, PNG, GIF, WEBP)</li>
                        <li>파일 크기가 5MB 이하인지 확인</li>
                        <li>파일 확장자와 실제 파일 형식이 일치하는지 확인</li>
                        <li>네트워크 연결 상태 확인</li>
                        <li>서버가 실행 중인지 확인</li>
                    </ul>
                </div>
            `;
        }
        
        function resetUploadForm() {
            clearFileSelection();
            hideAllUploadStates();
            
            // 폼 초기화
            document.getElementById('attachmentType').value = '';
            document.getElementById('attachmentId').value = '';
            
            logApi('🔄 업로드 폼이 초기화되었습니다.');
        }
        
        // 드래그 앤 드롭 지원
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            
            if (uploadArea) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight(e) {
                    uploadArea.style.borderColor = '#2563eb';
                    uploadArea.style.backgroundColor = '#eff6ff';
                }
                
                function unhighlight(e) {
                    uploadArea.style.borderColor = '#d1d5db';
                    uploadArea.style.backgroundColor = 'transparent';
                }
                
                uploadArea.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    if (files.length > 0) {
                        const file = files[0];
                        document.getElementById('fileInput').files = files;
                        handleFileSelect({ target: { files: [file] } });
                    }
                }
            }
        });
    </script>
</body>
</html>