# ëŒ“ê¸€ ì‹œìŠ¤í…œ ë° ë°˜ì‘ ì‹œìŠ¤í…œ í†µí•© ë¬¸ì œ í•´ê²° ê¸°ë¡

**ì‘ì—… ì¼ì**: 2025-06-24  
**ë‹´ë‹¹ì**: Claude Code  
**ì‘ì—… ë²”ìœ„**: ëŒ“ê¸€ ì‹œìŠ¤í…œ ë²„ê·¸ ìˆ˜ì • ë° ê²Œì‹œê¸€ ë°˜ì‘ ì‹œìŠ¤í…œ ê°œì„ 

## ğŸ“‹ ì‘ì—… ê°œìš”

### ìˆ˜í–‰í•œ ì‘ì—… ìš”ì•½
1. **ëŒ“ê¸€ ì¡°íšŒ HTTP 500 ì˜¤ë¥˜ í•´ê²°**
   - Beanie ODM ì¿¼ë¦¬ ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •
   - `ExpressionField` ê°ì²´ í˜¸ì¶œ ë¶ˆê°€ ì˜¤ë¥˜ í•´ê²°

2. **ë‹µê¸€ í‘œì‹œ ê¸°ëŠ¥ êµ¬í˜„**
   - ë‹µê¸€ ë Œë”ë§ ë¡œì§ ì¶”ê°€
   - CSS ìŠ¤íƒ€ì¼ë§ ë° ê³„ì¸µ êµ¬ì¡° í‘œì‹œ

3. **ê²Œì‹œê¸€ ë°˜ì‘ ì§€ì†ì„± ë¬¸ì œ í•´ê²°**
   - í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì‹œ ë°˜ì‘ ìƒíƒœ ì´ˆê¸°í™” ë¬¸ì œ ìˆ˜ì •
   - API í˜¸ì¶œ ê¸°ë°˜ ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸

4. **ì¡°íšŒìˆ˜ ê¸°ëŠ¥ ë³µêµ¬**
   - MongoDB ì¿¼ë¦¬ ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •
   - ì‹¤ì‹œê°„ í†µê³„ ì§‘ê³„ ì‹œìŠ¤í…œ êµ¬í˜„

## ğŸ› ë°œìƒí•œ ë¬¸ì œì™€ í•´ê²° ê³¼ì •

### 1. ëŒ“ê¸€ ì¡°íšŒ ì‹œ HTTP 500 ì˜¤ë¥˜
**ë¬¸ì œ**: `'ExpressionField' object is not callable` ì˜¤ë¥˜ ë°œìƒ

**ì›ì¸ ë¶„ì„**:
```python
# ì˜ëª»ëœ Beanie ì¿¼ë¦¬ ë¬¸ë²•
reactions = await UserReaction.find(UserReaction.user_id == str(current_user.id)).to_list()
```

**í•´ê²°ì±…**:
```python
# ì˜¬ë°”ë¥¸ MongoDB ë”•ì…”ë„ˆë¦¬ ì¿¼ë¦¬
reactions = await UserReaction.find({
    "user_id": str(current_user.id),
    "target_type": "comment",
    "target_id": {"$in": all_comment_ids}
}).to_list()
```

### 2. ë‹µê¸€ í‘œì‹œ ê¸°ëŠ¥ ëˆ„ë½
**ë¬¸ì œ**: ë‹µê¸€ ìƒì„±ì€ ë˜ì§€ë§Œ UIì— í‘œì‹œë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
- `renderComments()` í•¨ìˆ˜ì— ë‹µê¸€ ë Œë”ë§ ë¡œì§ ì¶”ê°€
- ê³„ì¸µí˜• êµ¬ì¡°ë¥¼ ìœ„í•œ CSS ìŠ¤íƒ€ì¼ êµ¬í˜„
- ë‹µê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ê¸°ëŠ¥ í†µí•©

### 3. ê²Œì‹œê¸€ ë°˜ì‘ ìƒíƒœ ì´ˆê¸°í™”
**ë¬¸ì œ**: ê²Œì‹œê¸€ ìƒì„¸ â†’ ëª©ë¡ìœ¼ë¡œ ì´ë™ ì‹œ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ìƒíƒœê°€ ë¦¬ì…‹ë¨

**í•´ê²°ì±…**:
- ê²Œì‹œê¸€ ëª©ë¡ APIì—ì„œ ì‹¤ì‹œê°„ í†µê³„ ë°˜í™˜
- `postsCache` ì¶”ê°€ë¡œ ë°ì´í„° ì¼ê´€ì„± ìœ ì§€
- í˜ì´ì§€ ì „í™˜ ì‹œ í•­ìƒ ìµœì‹  ë°ì´í„° ë¡œë“œ

### 4. ì¡°íšŒìˆ˜ ì¦ê°€ ê¸°ëŠ¥ ì˜¤ì‘ë™
**ë¬¸ì œ**: `Post.find_one(...).update(...)` ë¬¸ë²• ì˜¤ë¥˜

**í•´ê²°ì±…**:
```python
# ìˆ˜ì • ì „
await Post.find_one({"_id": PydanticObjectId(post_id)}).update({"$inc": {"view_count": 1}})

# ìˆ˜ì • í›„  
await Post.find({"_id": PydanticObjectId(post_id)}).update({"$inc": {"view_count": 1}})
```

### 5. JavaScript ë¹„ë™ê¸° í•¨ìˆ˜ ë¬¸ë²• ì˜¤ë¥˜
**ë¬¸ì œ**: `await is only valid in async functions` ì˜¤ë¥˜

**í•´ê²°ì±…**: `showPage` í•¨ìˆ˜ì—ì„œ `await` ì œê±°í•˜ê³  ë¹„ë™ê¸° í˜¸ì¶œë¡œ ë³€ê²½

## ğŸ“Š TDD ì§„í–‰ ìƒí™©ê³¼ ë¬¸ì œ ì˜ˆë°© ì‹¤íŒ¨ ë¶„ì„

### ê´€ë ¨ Task ë¶„ì„

#### Task 4: ëŒ“ê¸€ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„
- **ì§„í–‰ ìƒíƒœ**: ë¶€ë¶„ êµ¬í˜„ë¨
- **ë¯¸ì™„ë£Œ Subtask**:
  - `test_get_comments_with_user_data` - ì‚¬ìš©ì ë°˜ì‘ ì •ë³´ í¬í•¨ ì¡°íšŒ
  - `test_reply_comments` - ëŒ€ëŒ“ê¸€ ì²˜ë¦¬ ì„œë¹„ìŠ¤

#### Task 5: ë°˜ì‘ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„  
- **ì§„í–‰ ìƒíƒœ**: ê¸°ë³¸ êµ¬í˜„ë¨, í†µí•© í…ŒìŠ¤íŠ¸ ë¯¸ì™„ë£Œ
- **ë¯¸ì™„ë£Œ Subtask**:
  - `test_stats_aggregation` - í†µê³„ ì§‘ê³„ ë° ì—…ë°ì´íŠ¸
  - `test_reactions_router_with_auth` - ë°˜ì‘ API ë¼ìš°í„°

### TDDê°€ ë¬¸ì œë¥¼ ì˜ˆë°©í•˜ì§€ ëª»í•œ ì´ìœ 

1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•©ì˜ ê²©ì°¨**
   - ê°œë³„ ì»´í¬ë„ŒíŠ¸ëŠ” ë™ì‘í•˜ì§€ë§Œ í†µí•© ì‹œ Beanie ì¿¼ë¦¬ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ
   - ì‹¤ì œ MongoDB ì—°ë™ í…ŒìŠ¤íŠ¸ ë¶€ì¡±

2. **í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸ ë¶€ì¬**
   - API ì‘ë‹µ í˜•ì‹ê³¼ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ëŒ€ê°’ ë¶ˆì¼ì¹˜
   - í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì—†ìŒ

3. **ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì‹œë‚˜ë¦¬ì˜¤ ë¯¸ê³ ë ¤**
   - ìºì‹œì™€ ì‹¤ì œ ë°ì´í„° ê°„ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸ ë¶€ì¡±
   - ìƒíƒœ ì „í™˜ ì‹œ ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦ ì—†ìŒ

4. **ìˆœì°¨ì  TDD ì§„í–‰ ë°©ì‹ì˜ í•œê³„**
   - Task 4, 5ê°€ ë™ì‹œì— í•„ìš”í•œ ê¸°ëŠ¥ì´ì§€ë§Œ ìˆœì°¨ ì§„í–‰ìœ¼ë¡œ ì¸í•œ í†µí•© ì§€ì—°
   - í¬ë¡œìŠ¤ ë„ë©”ì¸ ê¸°ëŠ¥ ê°„ ì˜ì¡´ì„± ê³ ë ¤ ë¶€ì¡±

## ğŸ”§ ë¬¸ì œ í•´ê²° ë° ì˜ˆë°©ì„ ìœ„í•œ ì‹¤ìš©ì  ë°©ë²•ë“¤

### 1. í†µí•© í…ŒìŠ¤íŠ¸ ê°•í™”
```bash
# ì œì•ˆí•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
pytest tests/integration/test_comments_reactions_integration.py -v
pytest tests/integration/test_frontend_backend_integration.py -v
```

**êµ¬í˜„ ë°©í–¥**:
- ì‹¤ì œ MongoDB ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•œ E2E í…ŒìŠ¤íŠ¸
- í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìë™í™”
- í˜ì´ì§€ ì „í™˜ ë° ìƒíƒœ ë™ê¸°í™” í…ŒìŠ¤íŠ¸

### 2. API ê³„ì•½ í…ŒìŠ¤íŠ¸ (Contract Testing)
```python
# API ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦
def test_comments_api_contract():
    response = client.get("/api/posts/test-slug/comments")
    assert response.status_code == 200
    assert "comments" in response.json()
    assert "replies" in response.json()["comments"][0]
```

### 3. ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸
```python
# ìƒíƒœ ë™ê¸°í™” ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
def test_reaction_sync_across_pages():
    # 1. ê²Œì‹œê¸€ ìƒì„¸ì—ì„œ ì¢‹ì•„ìš”
    # 2. ê²Œì‹œê¸€ ëª©ë¡ìœ¼ë¡œ ì´ë™
    # 3. ì¢‹ì•„ìš” ìƒíƒœ ìœ ì§€ í™•ì¸
    pass
```

### 4. ê°œë°œ í™˜ê²½ ê°œì„  ë°©ì•ˆ

#### A. ì‹¤ì‹œê°„ ë¬¸ë²• ê²€ì¦
```json
// .vscode/settings.json
{
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": true,
  "eslint.validate": ["javascript", "html"]
}
```

#### B. pre-commit í›… ì„¤ì •
```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: pytest-check
        name: pytest-check
        entry: pytest tests/unit/ -x
        language: system
        pass_filenames: false
```

#### C. ê°œë°œ ì‹œ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸
```bash
# íŒŒì¼ ë³€ê²½ ê°ì§€ ìë™ í…ŒìŠ¤íŠ¸
pytest-watch tests/unit/test_comments_service.py
```

### 5. ì½”ë“œ í’ˆì§ˆ ê°œì„  ë°©ì•ˆ

#### A. íƒ€ì… íŒíŠ¸ ê°•í™”
```python
from typing import Dict, List, Optional, Union
from pydantic import BaseModel

async def get_comments_with_reactions(
    post_slug: str, 
    current_user: Optional[User] = None
) -> Dict[str, List[CommentWithReactions]]:
    ...
```

#### B. ì—ëŸ¬ í•¸ë“¤ë§ í‘œì¤€í™”
```python
class CommentServiceError(Exception):
    """ëŒ“ê¸€ ì„œë¹„ìŠ¤ ê¸°ë³¸ ì˜ˆì™¸"""
    pass

class CommentNotFoundError(CommentServiceError):
    """ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ"""
    pass
```

#### C. ë¡œê¹… ì‹œìŠ¤í…œ ë„ì…
```python
import logging

logger = logging.getLogger(__name__)

async def get_comments(post_slug: str):
    logger.info(f"Loading comments for post: {post_slug}")
    try:
        # ë¡œì§ ì‹¤í–‰
        logger.info(f"Successfully loaded {len(comments)} comments")
    except Exception as e:
        logger.error(f"Failed to load comments: {e}")
        raise
```

### 6. ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ

#### A. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```python
import time
from functools import wraps

def monitor_performance(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        result = await func(*args, **kwargs)
        execution_time = time.time() - start_time
        logger.info(f"{func.__name__} executed in {execution_time:.2f}s")
        return result
    return wrapper
```

#### B. í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
```python
@router.get("/health")
async def health_check():
    try:
        # DB ì—°ê²° í™•ì¸
        await Post.find_one()
        return {"status": "healthy", "timestamp": datetime.utcnow()}
    except Exception as e:
        return {"status": "unhealthy", "error": str(e)}
```

### 7. ê°œë°œ ì›Œí¬í”Œë¡œìš° ê°œì„ 

#### A. ê¸°ëŠ¥ ë¸Œëœì¹˜ ì „ëµ
```bash
# ê¸°ëŠ¥ë³„ ë¸Œëœì¹˜ ìƒì„±
git checkout -b feature/comments-reactions-integration
git checkout -b hotfix/beanie-query-syntax
```

#### B. ì ì§„ì  ë°°í¬ (Feature Flags)
```python
from config import settings

if settings.ENABLE_REACTION_SYSTEM:
    # ìƒˆë¡œìš´ ë°˜ì‘ ì‹œìŠ¤í…œ ì‚¬ìš©
else:
    # ê¸°ì¡´ ì‹œìŠ¤í…œ ìœ ì§€
```

#### C. ë¡¤ë°± ê³„íš
```python
# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸
# migrations/rollback_comments_reactions.py
```

## ğŸ“ˆ í–¥í›„ ê°œì„  ê³„íš

### ë‹¨ê¸° ê³„íš (1-2ì£¼)
1. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í–¥ìƒ**
   - í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
   - API ê³„ì•½ í…ŒìŠ¤íŠ¸ êµ¬í˜„
   
2. **ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•**
   - ë¡œê¹… ì‹œìŠ¤í…œ ë„ì…
   - ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

### ì¤‘ê¸° ê³„íš (1ê°œì›”)
1. **ìë™í™”ëœ QA íŒŒì´í”„ë¼ì¸**
   - CI/CDì— í…ŒìŠ¤íŠ¸ ìë™í™” í†µí•©
   - ë°°í¬ ì „ ìë™ ê²€ì¦ ì‹œìŠ¤í…œ

2. **ì½”ë“œ í’ˆì§ˆ ë„êµ¬ ë„ì…**
   - SonarQube ë˜ëŠ” CodeClimate ì—°ë™
   - ì •ì  ë¶„ì„ ë„êµ¬ ì ìš©

### ì¥ê¸° ê³„íš (3ê°œì›”)
1. **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê³ ë ¤**
   - ëŒ“ê¸€/ë°˜ì‘ ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ë¶„ë¦¬
   - ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ ë„ì…

2. **ì„±ëŠ¥ ìµœì í™”**
   - ìºì‹± ì „ëµ ê°œì„ 
   - ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”

## ğŸ’¡ í•µì‹¬ êµí›ˆ

1. **í†µí•© í…ŒìŠ¤íŠ¸ì˜ ì¤‘ìš”ì„±**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë§Œìœ¼ë¡œëŠ” ì‹¤ì œ ìš´ì˜ í™˜ê²½ì˜ ë¬¸ì œë¥¼ ì˜ˆë°©í•˜ê¸° ì–´ë ¤ì›€
2. **ì‹¤ì‹œê°„ ë™ê¸°í™” ë³µì¡ì„±**: í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ê°„ ë°ì´í„° ë™ê¸°í™”ëŠ” ë³„ë„ì˜ ì„¤ê³„ì™€ í…ŒìŠ¤íŠ¸ê°€ í•„ìš”
3. **ORM ë¬¸ë²• ìˆ™ì§€**: Beanie ODMì˜ ì •í™•í•œ ì¿¼ë¦¬ ë¬¸ë²• ì´í•´ í•„ìš”
4. **ì ì§„ì  ê°œë°œ**: ë³µì¡í•œ ê¸°ëŠ¥ì€ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ë‹¨ê³„ì  êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸ í•„ìš”

ì´ë²ˆ ì‘ì—…ì„ í†µí•´ ëŒ“ê¸€ ì‹œìŠ¤í…œê³¼ ë°˜ì‘ ì‹œìŠ¤í…œì˜ í•µì‹¬ ë¬¸ì œë“¤ì„ í•´ê²°í–ˆìœ¼ë©°, í–¥í›„ ìœ ì‚¬í•œ ë¬¸ì œë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•œ ì²´ê³„ì ì¸ ê°œì„  ë°©ì•ˆì„ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.