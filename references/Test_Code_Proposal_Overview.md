# 테스트 코드 제안 개요

**작성일**: 2025-06-26  
**목적**: 에디터 통합 계획을 기반으로 한 체계적 테스트 코드 구성 방안

## 📋 현재 기능 개발과 관련된 테스트 모듈과 함수 관계

### 테스트 모듈 구조 (의존성 관계)
```
tests/
├── unit/
│   ├── test_content_service.py        # 🔵 기반 (의존성 없음)
│   │   ├── test_render_markdown()
│   │   ├── test_sanitize_html()
│   │   ├── test_extract_metadata()
│   │   └── test_process_content()
│   ├── test_models_extended.py        # 🔵 기반 (의존성 없음)
│   │   ├── test_post_content_fields()
│   │   ├── test_content_type_validation()
│   │   └── test_metadata_validation()
│   ├── test_content_upload.py         # 🟡 조합 (content_service 의존)
│   │   ├── test_inline_image_upload()
│   │   ├── test_batch_file_upload()
│   │   └── test_upload_security()
│   └── test_posts_service_extended.py # 🟡 조합 (content_service 의존)
│       ├── test_content_processing()
│       ├── test_search_with_markdown()
│       └── test_content_migration()
├── integration/
│   ├── test_editor_api.py             # 🔴 통합 (모든 기능 의존)
│   │   ├── test_full_markdown_flow()
│   │   ├── test_inline_upload_flow()
│   │   └── test_preview_api_flow()
│   └── test_content_workflow.py       # 🔴 통합 (API + DB 의존)
│       ├── test_create_markdown_post()
│       ├── test_edit_existing_post()
│       └── test_migration_workflow()
└── contract/
    └── test_editor_api_contract.py    # 🟠 계약 (API 의존)
        ├── test_upload_inline_contract()
        ├── test_preview_contract()
        └── test_posts_extended_contract()
```

### 모듈 간 관계 시각화
```
┌─────────────────────── 테스트 모듈 의존성 그래프 ────────────────────────┐
│                                                                      │
│  🔵 기반 계층 (독립적)                                                   │
│  ┌─────────────────┐    ┌─────────────────┐                          │
│  │ test_content_   │    │ test_models_    │                          │
│  │ service.py      │    │ extended.py     │                          │
│  └─────────────────┘    └─────────────────┘                          │
│           │                       │                                  │
│           └───────┬───────────────┘                                  │
│                   ▼                                                  │
│  🟡 조합 계층 (기반 기능 활용)                                           │
│  ┌─────────────────┐    ┌─────────────────┐                          │
│  │ test_content_   │    │ test_posts_     │                          │
│  │ upload.py       │    │ service_ext.py  │                          │
│  └─────────────────┘    └─────────────────┘                          │
│           │                       │                                  │
│           └───────┬───────────────┘                                  │
│                   ▼                                                  │
│  🔴 통합 계층 (모든 기능 통합)                                           │
│  ┌─────────────────┐    ┌─────────────────┐                          │
│  │ test_editor_    │    │ test_content_   │                          │
│  │ api.py          │    │ workflow.py     │                          │
│  └─────────────────┘    └─────────────────┘                          │
│           │                       │                                  │
│           └───────┬───────────────┘                                  │
│                   ▼                                                  │
│  🟠 계약 계층 (API 인터페이스)                                           │
│  ┌─────────────────┐                                                 │
│  │ test_editor_    │                                                 │
│  │ api_contract.py │                                                 │
│  └─────────────────┘                                                 │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

## 🔄 기능 플로우와 테스트 함수 매핑

### 플로우 시각화
```
┌──────────────────────── 에디터 통합 기능 플로우 ────────────────────────┐
│                                                                    │
│  📝 마크다운 입력 ──→ 🔍 콘텐츠 처리 ──→ 🖼️ 인라인 업로드 ──→ 💾 저장 ──→ 📤 표시  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### 각 단계별 테스트 함수 매핑

- **📝 마크다운 입력 단계**: 
  - `test_content_type_validation()` - 콘텐츠 타입 검증
  - `test_markdown_syntax_parsing()` - 마크다운 구문 해석
  - `test_editor_input_sanitization()` - 입력 데이터 검증

- **🔍 콘텐츠 처리 단계**: 
  - `test_render_markdown()` - 마크다운 → HTML 변환
  - `test_sanitize_html()` - XSS 방지 새니타이징
  - `test_extract_metadata()` - 메타데이터 추출 (단어수, 읽기시간)
  - `test_process_content()` - 전체 콘텐츠 처리 플로우

- **🖼️ 인라인 업로드 단계**: 
  - `test_inline_image_upload()` - 에디터 내 이미지 업로드
  - `test_upload_security()` - 업로드 보안 검증
  - `test_drag_drop_handling()` - 드래그앤드롭 처리

- **💾 저장 단계**: 
  - `test_post_content_fields()` - 확장된 모델 필드 저장
  - `test_content_migration()` - 기존 데이터 마이그레이션
  - `test_database_transaction()` - 트랜잭션 무결성

- **📤 표시 단계**: 
  - `test_preview_api_flow()` - 실시간 미리보기
  - `test_rendered_content_display()` - 렌더링된 콘텐츠 표시
  - `test_search_with_markdown()` - 마크다운 콘텐츠 검색

### 통합 테스트
- `test_full_markdown_flow()` - 입력부터 표시까지 전체 플로우
- `test_inline_upload_flow()` - 에디터 내 파일 업로드 전체 플로우
- `test_create_markdown_post()` - 마크다운 게시글 생성 워크플로우

## 🌟 사용자 시나리오별 테스트 매핑

```
┌─────────────── 사용자 시나리오 → 테스트 매핑 ────────────────┐
│                                                            │
│  🌟 주 시나리오 (Happy Path)                                │
│  "사용자가 마크다운 에디터로 이미지 포함 게시글 작성"          │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 시나리오: 에디터 열기 → 마크다운 작성 → 이미지 첨부       │ │
│  │         → 미리보기 확인 → 게시글 저장 → 렌더링 표시     │ │
│  │ 테스트: test_render_markdown()                        │ │
│  │        test_inline_image_upload()                     │ │
│  │        test_preview_api_flow()                        │ │
│  │        test_full_markdown_flow()                      │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
│  ⚠️ 오류 시나리오 (Error Cases)                             │
│  "잘못된 마크다운 구문이나 보안 위험 콘텐츠"                   │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 시나리오: 악성 HTML 입력 → XSS 차단                    │ │
│  │         무효한 이미지 업로드 → 적절한 오류 처리         │ │
│  │ 테스트: test_sanitize_html()                          │ │
│  │        test_upload_security()                         │ │
│  │        test_malicious_content_blocking()              │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
│  🔧 예외 시나리오 (Edge Cases)                              │
│  "대용량 콘텐츠나 복잡한 마크다운 구조"                       │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 시나리오: 매우 긴 마크다운 문서, 복잡한 중첩 구조        │ │
│  │         대량 이미지 업로드, 동시 편집 상황              │ │
│  │ 테스트: test_large_content_processing()               │ │
│  │        test_complex_markdown_structure()              │ │
│  │        test_concurrent_editing()                      │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

## 🎯 구현 순서 제안 (사용자 플로우 검증 포함)

```
┌───────────────── 구현 단계별 로드맵 (사용자 플로우 검증 포함) ─────────────────┐
│                                                                         │
│  1️⃣ 1단계: 🟦 필수 (MVP) - 마크다운 에디터 핵심 기능                        │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 📋 기반 기능 구현 (의존성 없음)                                    │ │
│  │ ① test_render_markdown() 🟡 중급 ⚡병렬                           │ │
│  │ ② test_sanitize_html() 🟡 중급 ⚡병렬                             │ │
│  │ ③ test_post_content_fields() 🟢 초급 ⚡병렬                       │ │
│  │ ④ test_content_type_validation() 🟢 초급 ⚡병렬                   │ │
│  │                                                                 │ │
│  │ ⚙️ 조합 기능 구현 (기반 기능 활용)                                │ │
│  │ ⑤ test_process_content() 🟡 중급 🔄순차                          │ │
│  │ ⑥ test_inline_image_upload() 🟡 중급 🔄순차                      │ │
│  │ ⑦ test_upload_security() 🔴 고급 🔄순차                          │ │
│  │                                                                 │ │
│  │ 🔌 API 계약 (Contract)                                          │ │
│  │ ⑧ test_upload_inline_contract() 🟢 초급 🔄순차                   │ │
│  │ ⑨ test_preview_contract() 🟢 초급 🔄순차                         │ │
│  │                                                                 │ │
│  │ 🎯 1단계 완료 시점 - 즉시 사용자 플로우 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 프런트엔드 통합 테스트 (즉시 실행)                         │ │ │
│  │ │ • 마크다운 에디터 → API 호출 → 렌더링 확인                    │ │ │
│  │ │ • 인라인 이미지 업로드 → 에디터에 표시 전체 플로우             │ │ │
│  │ │ • 실시간 미리보기 → 사용자 편의성 검증                        │ │ │
│  │ │ • XSS 공격 차단 → 보안 테스트                                │ │ │
│  │ │                                                             │ │ │
│  │ │ 🔍 발견된 문제점 기반 우선순위 재조정                          │ │ │
│  │ │ • 에디터 응답 속도 느림 → 성능 최적화 우선순위 상향           │ │ │
│  │ │ • 이미지 업로드 실패 → 에러 핸들링 개선 우선순위               │ │ │
│  │ │ • 마크다운 구문 오류 → 검증 로직 강화 우선순위                │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  2️⃣ 2단계: 🟡 권장 (안정화) - 고급 에디터 기능                          │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 📋 정상 시나리오 (1단계 플로우 검증 결과 반영)                     │ │
│  │ ① test_extract_metadata() 🟡 중급 🔄순차                         │ │
│  │   └─ 📌 1단계 검증에서 "읽기 시간 표시 필요" 발견 시 우선 처리     │ │
│  │ ② test_batch_file_upload() 🟡 중급 🔄순차                        │ │
│  │   └─ 📌 1단계 검증에서 "다중 파일 업로드 불편" 피드백 시 우선      │ │
│  │ ③ test_content_migration() 🔴 고급 🔄순차                        │ │
│  │   └─ 📌 기존 게시글 호환성 이슈 발견 시 우선 처리                │ │
│  │                                                                 │ │
│  │ ⚠️ 오류 처리 (1단계 플로우 검증 결과 반영)                        │ │
│  │ ④ test_large_content_processing() 🔴 고급 🔄순차                 │ │
│  │   └─ 📌 1단계 검증에서 "긴 글 처리 속도 문제" 발견 시 우선         │ │
│  │ ⑤ test_malicious_content_blocking() 🔴 고급 🔄순차               │ │
│  │   └─ 📌 추가 보안 테스트 필요성 발견 시 우선                     │ │
│  │                                                                 │ │
│  │ 🔌 API 계약                                                    │ │
│  │ ⑥ test_posts_extended_contract() 🟡 중급 🔄순차                  │ │
│  │                                                                 │ │
│  │ 🎯 2단계 완료 시점 - 재차 사용자 플로우 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 개선된 기능의 사용자 경험 재검증                            │ │ │
│  │ │ • 메타데이터 표시가 실제로 유용한지 확인                       │ │ │
│  │ │ • 배치 업로드가 사용자 워크플로우를 개선했는지 검증            │ │ │
│  │ │ • 마이그레이션이 기존 사용자에게 문제없는지 확인              │ │ │
│  │ │                                                             │ │ │
│  │ │ 🔍 3단계 우선순위 최종 결정                                   │ │ │
│  │ │ • 사용자가 실제로 필요로 하는 최적화 기능만 3단계에서 구현     │ │ │
│  │ │ • 성능 개선 체감도 낮으면 3단계 축소                          │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  3️⃣ 3단계: 🟢 선택 (최적화) - 성능 및 고급 기능 (사용자 검증 완료된 것만)   │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 📋 정상 시나리오 (사용자 실제 요구사항 기반)                       │ │
│  │ ① test_content_caching() 🔴 고급 🔄순차                          │ │
│  │   └─ 📌 2단계 검증에서 "렌더링 속도 개선 필요" 확인 시에만         │ │
│  │ ② test_image_optimization() 🔴 고급 🔄순차                       │ │
│  │   └─ 📌 2단계 검증에서 "이미지 로딩 속도 문제" 확인 시에만         │ │
│  │ ③ test_advanced_editor_features() 🔴 고급 🔄순차                 │ │
│  │   └─ 📌 2단계 검증에서 "고급 편집 기능 요구" 확인 시에만           │ │
│  │                                                                 │ │
│  │ ⚠️ 오류 처리                                                   │ │
│  │ ④ test_concurrent_editing() 🔴 고급 🔄순차                       │ │
│  │ ⑤ test_complex_markdown_structure() 🔴 고급 🔄순차               │ │
│  │                                                                 │ │
│  │ 🎯 3단계 완료 시점 - 최종 사용자 만족도 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 전체 에디터 시스템 사용자 경험 최종 점검                    │ │ │
│  │ │ • 모든 기능이 실제 글쓰기 워크플로우에서 유용한지 확인         │ │ │
│  │ │ • 성능 최적화가 체감 가능한 수준인지 검증                     │ │ │
│  │ │ • 전체적인 편집 경험이 직관적이고 효율적인지 확인              │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  💡 핵심 구현 원칙:                                                    │
│  • 🔄 각 단계 완료 → 즉시 실제 에디터 환경에서 테스트                   │
│  • 📊 사용자 글쓰기 경험 관점에서의 피드백 → 다음 단계 우선순위 재조정   │
│  • ⚡ 병렬 가능한 테스트는 동시 진행으로 효율성 확보                    │
│  • 🎯 사용자가 실제로 필요로 하지 않는 기능은 구현하지 않음             │
│  • 🟦 1단계(MVP) 완료만으로도 실용적인 마크다운 에디터 제공             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 🔍 단계별 필수 검증 항목

### 1단계 완료 후 즉시 검증
```
✅ 마크다운 에디터가 브라우저에서 정상 작동하는가?
✅ 마크다운 → HTML 변환이 예상대로 이루어지는가?
✅ 인라인 이미지 업로드가 에디터에 올바르게 삽입되는가?
✅ XSS 공격이 효과적으로 차단되는가?
✅ 실시간 미리보기가 사용자에게 유용한가?

📝 발견 사항 → 2단계 우선순위 조정 기준
• 에디터 성능 이슈 → 캐싱/최적화 우선순위 상향
• 업로드 오류 → 에러 핸들링 개선 우선순위
• 보안 누락 → 추가 보안 테스트 우선순위
```

### 2단계 완료 후 재검증
```
✅ 메타데이터 표시(읽기시간 등)가 실제로 유용한가?
✅ 배치 업로드가 사용자 워크플로우를 개선했는가?
✅ 기존 게시글 마이그레이션이 문제없이 완료되었는가?
✅ 전체적인 편집 경험이 향상되었는가?

📝 발견 사항 → 3단계 진행 여부 결정
• 사용자 만족도 충분 → 3단계 축소/생략
• 특정 성능 개선 요구 → 해당 기능만 구현
• 고급 기능 필요성 확인 → 3단계 진행
```

## 🛡️ Classic TDD 원칙 준수 지침

### Mock 사용 정책
```python
def test_content_rendering_with_external_service():
    """
    🚨 Mock 사용: ImageOptimizationService
    이유: 외부 이미지 처리 서비스 호출로 인한 네트워크 의존성
    대안 없이 진행 시: 테스트 불안정성, 실행 시간 증가
    """
    # 이미 구현 완료된 ImageService를 Mock으로 처리
    pass

def test_markdown_rendering():
    """
    🚨 Mock 없음: Python-Markdown 라이브러리
    이유: 로컬 라이브러리 호출, 빠른 실행, 안정적 동작
    """
    # 실제 마크다운 렌더링 로직 테스트
    pass
```

### API 계약 테스트 (MVP 수준)
```python
def assert_editor_api_basic_contract(response, required_fields=None):
    """MVP 에디터 API 계약 최소 검증"""
    assert response.status_code == 200
    assert response.headers["content-type"] == "application/json"
    data = response.json()
    
    # 필수 필드 존재 여부
    for field in (required_fields or []):
        assert field in data
    
    # 에디터 특화 필드 검증
    if "content_rendered" in data:
        assert isinstance(data["content_rendered"], str)
    if "word_count" in data:
        assert isinstance(data["word_count"], int)

def test_upload_inline_api_mvp_contract():
    """
    MVP 계약 검증:
    - 상태 코드: 200 (성공)
    - 응답 형식: JSON
    - 필수 필드: file_id, url, markdown (에디터 삽입용)
    - 데이터 타입: 모든 필드 문자열
    
    기록 사항 (향후 활용):
    - 전체 응답 필드: [file_id, url, markdown, html]
    - 오류 응답 형식: {detail: "error message"}
    """
    pass
```

이 테스트 코드 제안 개요는 에디터 통합 계획의 각 단계별로 체계적이고 실용적인 테스트 전략을 제시하며, 실제 사용자 플로우 검증을 통한 지속적인 우선순위 조정을 핵심으로 합니다.