# File API 테스트 코드 제안 개요

## 📋 문서 목차

1. [테스트 개요](#1-테스트-개요)
2. [현재 기능과 관련된 테스트 모듈 및 함수 관계](#2-현재-기능과-관련된-테스트-모듈-및-함수-관계)
3. [기능 플로우와 테스트 함수 매핑](#3-기능-플로우와-테스트-함수-매핑)
4. [사용자 시나리오별 테스트 매핑](#4-사용자-시나리오별-테스트-매핑)
5. [구현 순서 제안](#5-구현-순서-제안)

---

## 1. 테스트 개요

File API의 핵심 기능인 파일 업로드, 조회, 삭제 시스템에 대한 체계적인 테스트 코드를 제안합니다. Classic TDD 원칙을 준수하며, 실제 사용자 플로우 기반의 실용적인 테스트를 구성합니다.

### 테스트 대상 API 엔드포인트

```
POST /api/files/upload          # 파일 업로드
GET  /api/files/{file_id}       # 파일 조회/다운로드  
GET  /api/files/{file_id}/info  # 파일 메타데이터 조회
DELETE /api/files/{file_id}     # 파일 삭제
```

### 핵심 비즈니스 규칙

- **파일 형식 제한**: jpg, jpeg, png, gif, webp만 허용
- **파일 크기 제한**: 최대 5MB
- **첨부 개수 제한**: 게시글(5개), 댓글(1개), 프로필(1개)
- **보안 검증**: MIME 타입 + 확장자 이중 검증, 파일 헤더 검증

---

## 2. 현재 기능과 관련된 테스트 모듈 및 함수 관계

### 테스트 모듈 구조 (의존성 관계)

```
backend/tests/
├── unit/
│   ├── test_file_validator.py       # 🔵 기반 (의존성 없음)
│   │   ├── test_validate_file_type() 🟢 초급 ⚡병렬
│   │   ├── test_validate_file_size() 🟢 초급 ⚡병렬
│   │   ├── test_validate_file_extension() 🟢 초급 ⚡병렬
│   │   ├── test_validate_mime_type() 🟡 중급 ⚡병렬
│   │   └── test_validate_file_signature() 🔴 고급 ⚡병렬
│   ├── test_file_storage.py         # 🟡 조합 (validator 의존)
│   │   ├── test_generate_file_path() 🟢 초급 ⚡병렬
│   │   ├── test_save_file_to_disk() 🟡 중급 🔄순차
│   │   ├── test_create_directory_structure() 🟡 중급 🔄순차
│   │   └── test_cleanup_temp_files() 🟡 중급 🔄순차
│   ├── test_file_metadata.py        # 🔵 기반 (의존성 없음)
│   │   ├── test_extract_file_metadata() 🟡 중급 ⚡병렬
│   │   ├── test_create_file_document() 🟡 중급 ⚡병렬
│   │   └── test_generate_file_url() 🟢 초급 ⚡병렬
│   └── test_file_repository.py      # 🟡 조합 (metadata 의존)
│       ├── test_save_file_record() 🟡 중급 🔄순차
│       ├── test_find_file_by_id() 🟡 중급 🔄순차
│       ├── test_delete_file_record() 🟡 중급 🔄순차
│       └── test_update_file_references() 🔴 고급 🔄순차
├── integration/
│   ├── test_file_upload_api.py      # 🔴 통합 (모든 기능 의존)
│   │   ├── test_successful_upload_flow() 🔴 고급 🔄순차
│   │   ├── test_multiple_files_upload() 🔴 고급 🔄순차
│   │   ├── test_upload_with_attachment() 🔴 고급 🔄순차
│   │   └── test_upload_error_scenarios() 🟡 중급 🔄순차
│   ├── test_file_retrieval_api.py   # 🔴 통합 (storage + repository 의존)
│   │   ├── test_get_file_by_id() 🟡 중급 🔄순차
│   │   ├── test_get_file_metadata() 🟡 중급 🔄순차
│   │   └── test_file_not_found_handling() 🟡 중급 🔄순차
│   └── test_file_deletion_api.py    # 🔴 통합 (모든 기능 의존)
│       ├── test_delete_file_success() 🔴 고급 🔄순차
│       ├── test_delete_with_cleanup() 🔴 고급 🔄순차
│       └── test_delete_permission_check() 🟡 중급 🔄순차
└── contract/
    └── test_file_api_contract.py    # 🟠 계약 (API 의존)
        ├── test_upload_request_contract() 🟢 초급 🔄순차
        ├── test_upload_response_contract() 🟢 초급 🔄순차
        ├── test_error_response_contract() 🟡 중급 🔄순차
        └── test_file_url_format_contract() 🟢 초급 🔄순차
```

### 모듈 간 관계 시각화

```
┌─────────────────────── 테스트 모듈 의존성 그래프 ────────────────────────┐
│                                                                      │
│  🔵 기반 계층 (독립적)                                                   │
│  ┌─────────────────┐    ┌─────────────────┐                          │
│  │ test_file_      │    │ test_file_      │                          │
│  │ validator.py    │    │ metadata.py     │                          │
│  └─────────────────┘    └─────────────────┘                          │
│           │                       │                                  │
│           └───────┬───────────────┘                                  │
│                   ▼                                                  │
│  🟡 조합 계층 (기반 기능 활용)                                           │
│  ┌─────────────────┐    ┌─────────────────┐                          │
│  │ test_file_      │    │ test_file_      │                          │
│  │ storage.py      │    │ repository.py   │                          │
│  └─────────────────┘    └─────────────────┘                          │
│           │                       │                                  │
│           └───────┬───────────────┘                                  │
│                   ▼                                                  │
│  🔴 통합 계층 (모든 기능 통합)                                           │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    │
│  │ test_file_      │    │ test_file_      │    │ test_file_      │    │
│  │ upload_api.py   │    │ retrieval_api.py│    │ deletion_api.py │    │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘    │
│           │                       │                       │          │
│           └───────────────┬───────────────────────────────┘          │
│                           ▼                                          │
│  🟠 계약 계층 (API 인터페이스)                                           │
│  ┌─────────────────┐                                                 │
│  │ test_file_api_  │                                                 │
│  │ contract.py     │                                                 │
│  └─────────────────┘                                                 │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 3. 기능 플로우와 테스트 함수 매핑

### 파일 업로드 플로우

```
┌────────────────────────── 파일 업로드 플로우 ──────────────────────────┐
│                                                                      │
│  📤 요청 수신 ──→ 🔍 파일 검증 ──→ 💾 파일 저장 ──→ 📝 메타데이터 저장 ──→ 📤 응답  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

**각 단계별 테스트 함수 매핑:**

- **📤 요청 수신 단계**: 
  - `test_upload_request_contract()` - multipart/form-data 형식 검증
  - `test_authentication_check()` - Bearer 토큰 인증 확인
  - `test_request_parameter_validation()` - 필수 파라미터 검증

- **🔍 파일 검증 단계**: 
  - `test_validate_file_type()` - 허용된 이미지 형식 검증
  - `test_validate_file_size()` - 5MB 크기 제한 검증  
  - `test_validate_file_extension()` - 확장자와 MIME 타입 일치성
  - `test_validate_mime_type()` - MIME 타입 보안 검증
  - `test_validate_file_signature()` - 파일 헤더 시그니처 검증

- **💾 파일 저장 단계**: 
  - `test_generate_file_path()` - 고유 파일명 및 경로 생성
  - `test_save_file_to_disk()` - 물리적 파일 저장
  - `test_create_directory_structure()` - 년/월/타입별 디렉토리 생성
  - `test_cleanup_temp_files()` - 임시 파일 정리

- **📝 메타데이터 저장 단계**: 
  - `test_extract_file_metadata()` - 파일 정보 추출
  - `test_create_file_document()` - 파일 문서 생성
  - `test_save_file_record()` - MongoDB 저장
  - `test_generate_file_url()` - 접근 URL 생성

- **📤 응답 단계**: 
  - `test_upload_response_contract()` - 응답 형식 검증
  - `test_error_response_contract()` - 오류 응답 처리

### 파일 조회 플로우

```
┌────────────────────────── 파일 조회 플로우 ──────────────────────────┐
│                                                                    │
│  🌐 조회 요청 ──→ 🔍 파일 ID 검증 ──→ 📂 파일 검색 ──→ 📤 파일 반환      │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### 파일 삭제 플로우

```
┌────────────────────────── 파일 삭제 플로우 ──────────────────────────┐
│                                                                    │
│  🗑️ 삭제 요청 ──→ 🔐 권한 검증 ──→ 🔗 참조 정리 ──→ 💾 파일 삭제 ──→ 📤 응답  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

**통합 테스트**
- `test_successful_upload_flow()` - 전체 업로드 플로우 통합 검증
- `test_file_lifecycle_workflow()` - 업로드→조회→삭제 전체 워크플로우

---

## 4. 사용자 시나리오별 테스트 매핑

### 주 시나리오 (Happy Path)

```
┌─────────────── 사용자 시나리오 → 테스트 매핑 ────────────────┐
│                                                            │
│  🌟 시나리오 1: "게시글 작성 시 이미지 첨부"                  │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 사용자 행동: 로그인 → 파일 선택 → 업로드 → 게시글 작성     │ │
│  │ 관련 테스트:                                           │ │
│  │ • test_validate_file_type() 🟦 필수 🟢 초급 ⚡병렬       │ │
│  │ • test_save_file_to_disk() 🟦 필수 🟡 중급 🔄순차       │ │
│  │ • test_successful_upload_flow() 🟦 필수 🔴 고급 🔄순차   │ │
│  │ • test_upload_with_attachment() 🟦 필수 🔴 고급 🔄순차   │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
│  🌟 시나리오 2: "댓글에 이미지 첨부"                          │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 사용자 행동: 댓글 작성 → 이미지 첨부 (1개 제한)          │ │
│  │ 관련 테스트:                                           │ │
│  │ • test_single_file_upload() 🟦 필수 🟡 중급 🔄순차       │ │
│  │ • test_comment_attachment_limit() 🟦 필수 🟢 초급 ⚡병렬  │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
│  🌟 시나리오 3: "프로필 이미지 설정"                          │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 사용자 행동: 설정 페이지 → 프로필 이미지 업로드           │ │
│  │ 관련 테스트:                                           │ │
│  │ • test_profile_image_upload() 🟦 필수 🟡 중급 🔄순차     │ │
│  │ • test_profile_image_replacement() 🟡 권장 🟡 중급 🔄순차 │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### 오류 시나리오 (Error Cases)

```
┌─────────────── 오류 시나리오 → 테스트 매핑 ────────────────┐
│                                                          │
│  ⚠️ 시나리오 1: "파일 크기 초과"                           │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: 6MB 이미지 업로드 시도 → 오류 메시지 반환        │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_validate_file_size() 🟦 필수 🟢 초급 ⚡병렬      │ │
│  │ • test_oversized_file_rejection() 🟦 필수 🟢 초급 ⚡병렬 │ │
│  │ • test_upload_error_scenarios() 🟦 필수 🟡 중급 🔄순차  │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
│  ⚠️ 시나리오 2: "지원되지 않는 파일 형식"                   │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: PDF, EXE 파일 업로드 시도 → 형식 오류            │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_validate_file_extension() 🟦 필수 🟢 초급 ⚡병렬  │ │
│  │ • test_validate_mime_type() 🟦 필수 🟡 중급 ⚡병렬      │ │
│  │ • test_unsupported_format_rejection() 🟦 필수 🟢 초급   │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
│  ⚠️ 시나리오 3: "파일 개수 제한 초과"                       │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: 게시글에 6개 이미지 첨부 시도 → 개수 제한 오류    │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_post_attachment_limit() 🟦 필수 🟢 초급 ⚡병렬    │ │
│  │ • test_file_count_validation() 🟦 필수 🟢 초급 ⚡병렬    │ │
│  │ • test_multiple_files_upload() 🟦 필수 🔴 고급 🔄순차   │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 예외 시나리오 (Edge Cases)

```
┌─────────────── 예외 시나리오 → 테스트 매핑 ────────────────┐
│                                                          │
│  🔧 시나리오 1: "동시 파일 업로드"                          │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: 여러 사용자가 동시에 파일 업로드                  │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_concurrent_upload_handling() 🟢 선택 🔴 고급 🔄순차 │ │
│  │ • test_race_condition_prevention() 🟢 선택 🔴 고급 🔄순차 │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
│  🔧 시나리오 2: "악성 파일 업로드 시도"                     │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: 실행 파일을 이미지로 위장하여 업로드 시도         │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_validate_file_signature() 🟦 필수 🔴 고급 ⚡병렬  │ │
│  │ • test_malicious_file_detection() 🟦 필수 🔴 고급 ⚡병렬 │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
│  🔧 시나리오 3: "네트워크 장애 중 업로드"                   │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 상황: 업로드 중 연결 끊김, 부분 업로드 상태            │ │
│  │ 관련 테스트:                                         │ │
│  │ • test_upload_timeout_handling() 🟡 권장 🟡 중급 🔄순차  │ │
│  │ • test_cleanup_temp_files() 🟡 권장 🟡 중급 🔄순차      │ │
│  │ • test_partial_upload_recovery() 🟢 선택 🔴 고급 🔄순차 │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 5. 구현 순서 제안

### 사용자 플로우 검증을 포함한 단계별 구현 로드맵

```
┌───────────────── 구현 단계별 로드맵 (사용자 플로우 검증 포함) ─────────────────┐
│                                                                         │
│  1️⃣ 1단계: 🟦 필수 (MVP) - 시스템 안정성 핵심                           │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 📋 기반 기능 구현 (의존성 없음)                                    │ │
│  │ ① test_validate_file_type() 🟢 초급 ⚡병렬                        │ │
│  │ ② test_validate_file_size() 🟢 초급 ⚡병렬                        │ │
│  │ ③ test_validate_file_extension() 🟢 초급 ⚡병렬                   │ │
│  │ ④ test_generate_file_path() 🟢 초급 ⚡병렬                        │ │
│  │                                                                 │ │
│  │ ⚙️ 조합 기능 구현 (기반 기능 활용)                                │ │
│  │ ⑤ test_save_file_to_disk() 🟡 중급 🔄순차                        │ │
│  │ ⑥ test_extract_file_metadata() 🟡 중급 ⚡병렬                     │ │
│  │ ⑦ test_save_file_record() 🟡 중급 🔄순차                         │ │
│  │                                                                 │ │
│  │ 🔌 API 계약 (Contract)                                          │ │
│  │ ⑧ test_upload_request_contract() 🟢 초급 🔄순차                   │ │
│  │ ⑨ test_upload_response_contract() 🟢 초급 🔄순차                  │ │
│  │ ⑩ test_successful_upload_flow() 🔴 고급 🔄순차                    │ │
│  │                                                                 │ │
│  │ ⚠️ 필수 오류 처리                                               │ │
│  │ ⑪ test_oversized_file_rejection() 🟢 초급 ⚡병렬                   │ │
│  │ ⑫ test_unsupported_format_rejection() 🟢 초급 ⚡병렬               │ │
│  │                                                                 │ │
│  │ 🎯 1단계 완료 시점 - 즉시 사용자 플로우 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 프런트엔드 통합 테스트 (즉시 실행)                         │ │ │
│  │ │ • HTML UI에서 파일 선택 → 업로드 → 성공 응답 확인             │ │ │
│  │ │ • 업로드된 이미지가 게시글에서 정상 표시되는지 확인           │ │ │
│  │ │ • 파일 크기/형식 오류 시 적절한 사용자 메시지 표시           │ │ │
│  │ │                                                             │ │ │
│  │ │ 🔍 발견된 문제점 기반 우선순위 재조정                          │ │ │
│  │ │ • API 응답에서 누락된 필드 → 즉시 추가 (우선순위 최상)       │ │ │
│  │ │ • 불친절한 오류 메시지 → 2단계에서 개선 우선순위 상향        │ │ │
│  │ │ • 이미지 로딩 속도 문제 → 캐시/최적화 기능 우선순위 상향     │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  2️⃣ 2단계: 🟡 권장 (안정화) - 사용자 경험 개선                          │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 📋 고급 파일 처리 (1단계 플로우 검증 결과 반영)                     │ │
│  │ ① test_validate_mime_type() 🟡 중급 ⚡병렬                         │ │
│  │   └─ 📌 1단계에서 "보안 검증 부족" 발견 시 우선 처리               │ │
│  │ ② test_multiple_files_upload() 🔴 고급 🔄순차                     │ │
│  │   └─ 📌 1단계에서 "여러 파일 첨부 요구" 발견 시 우선 처리          │ │
│  │ ③ test_upload_with_attachment() 🔴 고급 🔄순차                    │ │
│  │                                                                 │ │
│  │ 📂 파일 조회 기능                                              │ │
│  │ ④ test_get_file_by_id() 🟡 중급 🔄순차                           │ │
│  │ ⑤ test_get_file_metadata() 🟡 중급 🔄순차                        │ │
│  │ ⑥ test_file_not_found_handling() 🟡 중급 🔄순차                   │ │
│  │                                                                 │ │
│  │ ⚠️ 향상된 오류 처리 (1단계 플로우 검증 결과 반영)                  │ │
│  │ ⑦ test_upload_error_scenarios() 🟡 중급 🔄순차                    │ │
│  │   └─ 📌 1단계에서 "오류 메시지 개선 필요" 발견 시 우선 처리        │ │
│  │ ⑧ test_error_response_contract() 🟡 중급 🔄순차                   │ │
│  │                                                                 │ │
│  │ 🎯 2단계 완료 시점 - 재차 사용자 플로우 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 개선된 기능의 사용자 경험 재검증                            │ │ │
│  │ │ • 다중 파일 업로드가 사용자에게 직관적인지 확인               │ │ │
│  │ │ • 개선된 오류 메시지가 실제로 이해하기 쉬운지 검증            │ │ │
│  │ │ • 파일 조회 속도가 사용자 기대 수준인지 확인                  │ │ │
│  │ │                                                             │ │ │
│  │ │ 🔍 3단계 우선순위 최종 결정                                   │ │ │
│  │ │ • 사용자가 실제로 필요로 하는 고급 기능만 3단계에서 구현      │ │ │
│  │ │ • 파일 삭제 기능이 필수인지 사용자 요구사항 재확인            │ │ │
│  │ │ • 성능 최적화 기능의 실제 필요성 검증                        │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  3️⃣ 3단계: 🟢 선택 (최적화) - 고급 기능 (사용자 검증 완료된 것만)        │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │ 🗑️ 파일 삭제 기능 (사용자 실제 요구사항 기반)                      │ │
│  │ ① test_delete_file_success() 🔴 고급 🔄순차                       │ │
│  │   └─ 📌 2단계 검증에서 "파일 관리 기능 필요" 사용자 요청 시에만     │ │
│  │ ② test_delete_with_cleanup() 🔴 고급 🔄순차                       │ │
│  │ ③ test_update_file_references() 🔴 고급 🔄순차                    │ │
│  │                                                                 │ │
│  │ 🔐 보안 강화                                                   │ │
│  │ ④ test_validate_file_signature() 🔴 고급 ⚡병렬                    │ │
│  │ ⑤ test_malicious_file_detection() 🔴 고급 ⚡병렬                   │ │
│  │                                                                 │ │
│  │ 🚀 성능 최적화                                                 │ │
│  │ ⑥ test_concurrent_upload_handling() 🔴 고급 🔄순차                │ │
│  │   └─ 📌 2단계 검증에서 "동시 업로드 성능 이슈" 발견 시에만         │ │
│  │ ⑦ test_file_caching_optimization() 🔴 고급 🔄순차                 │ │
│  │                                                                 │ │
│  │ 🎯 3단계 완료 시점 - 최종 사용자 만족도 검증                        │ │
│  │ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │ │ 📱 전체 시스템 사용자 경험 최종 점검                           │ │ │
│  │ │ • 모든 파일 관리 기능이 실제 업무에서 유용하게 사용되는지     │ │ │
│  │ │ • 보안 기능이 과도하지 않고 적절한 수준인지 확인              │ │ │
│  │ │ • 성능 최적화가 체감 가능한 수준의 개선을 제공하는지          │ │ │
│  │ └─────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  💡 핵심 구현 원칙:                                                    │
│  • 🔄 각 단계 완료 → 즉시 실제 사용자 환경에서 테스트                   │
│  • 📊 사용자 관점에서의 피드백 → 다음 단계 우선순위 재조정              │
│  • ⚡ 병렬 가능한 테스트는 동시 진행으로 효율성 확보                    │
│  • 🎯 사용자가 실제로 필요로 하지 않는 기능은 구현하지 않음             │
│  • 🟦 1단계(MVP) 완료만으로도 실용적 가치 제공 가능                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 단계별 사용자 플로우 검증 체크리스트

```
┌──────────────── 각 단계별 필수 검증 항목 ────────────────┐
│                                                        │
│  🔍 1단계 완료 후 즉시 검증                             │
│  ┌────────────────────────────────────────────────┐ │
│  │ ✅ HTML UI에서 파일 선택 후 업로드가 정상 작동하는가? │ │
│  │ ✅ 업로드된 이미지가 게시글에서 올바르게 표시되는가? │ │
│  │ ✅ 파일 크기/형식 오류 시 사용자가 이해할 수 있는가? │ │
│  │ ✅ API 응답에 프런트엔드에서 필요한 모든 데이터 포함? │ │
│  │ ✅ 업로드 속도가 사용자 기대 수준인가?              │ │
│  │                                                │ │
│  │ 📝 발견 사항 → 2단계 우선순위 조정 기준          │ │
│  │ • 누락된 API 필드 → 즉시 추가 (우선순위 최상)    │ │
│  │ • 오류 메시지 개선 → 2단계 우선순위 상향         │ │
│  │ • 성능 이슈 → 최적화 기능 우선순위 상향          │ │
│  └────────────────────────────────────────────────┘ │
│                                                        │
│  🔍 2단계 완료 후 재검증                               │
│  ┌────────────────────────────────────────────────┐ │
│  │ ✅ 다중 파일 업로드가 사용자에게 직관적인가?        │ │
│  │ ✅ 개선된 오류 메시지가 실제로 도움이 되는가?      │ │
│  │ ✅ 파일 조회 기능이 사용자 워크플로우에 적합한가?   │ │
│  │ ✅ 전체적인 파일 관리 경험이 만족스러운가?         │ │
│  │                                                │ │
│  │ 📝 발견 사항 → 3단계 진행 여부 결정              │ │
│  │ • 현재 기능으로 충분하면 → 3단계 축소/생략        │ │
│  │ • 파일 삭제 기능 요구 시 → 해당 기능만 구현       │ │
│  │ • 성능/보안 추가 개선 필요 시 → 3단계 진행       │ │
│  └────────────────────────────────────────────────┘ │
│                                                        │
│  🔍 3단계 완료 후 최종 검증                            │
│  ┌────────────────────────────────────────────────┐ │
│  │ ✅ 모든 파일 기능이 실제 업무에서 활용되고 있는가?  │ │
│  │ ✅ 보안 기능이 사용성을 해치지 않는 적절한 수준인가? │ │
│  │ ✅ 성능 최적화가 체감 가능한 개선을 제공하는가?     │ │
│  │ ✅ 시스템 전체가 안정적으로 운영되는가?           │ │
│  └────────────────────────────────────────────────┘ │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### Mock 사용 정책

**허용 조건**: 이미 구현 완료된 기능 중 호출 비용이 높은 경우

```python
def test_file_upload_with_notification():
    """
    🚨 Mock 사용: EmailNotificationService
    이유: 외부 SMTP 서버 호출로 인한 네트워크 의존성
    대안 없이 진행 시: 테스트 불안정성, 실행 시간 증가
    """
    # 이미 구현 완료된 EmailService를 Mock으로 처리
    pass

def test_file_storage_without_mock():
    """
    Mock 미사용: 로컬 파일시스템 저장
    이유: 빠른 실행, 실제 파일 I/O 검증 필요
    """
    # 실제 임시 디렉토리에 파일 저장/삭제로 테스트
    pass
```

### API 계약 테스트 (MVP 수준)

```python
def assert_file_api_basic_contract(response, required_fields=None):
    """MVP API 계약 최소 검증 - 상태코드, JSON형식, 필수필드, 타입"""
    pass
    
def record_api_contract(endpoint, response):
    """향후 본격 계약 테스트용 응답 구조 기록"""
    pass

# 적용 예시
def test_upload_api_mvp_contract():
    """
    MVP 계약 검증:
    - 상태 코드: 201 Created (성공)
    - 응답 형식: JSON
    - 필수 필드: file_id, file_url (프런트엔드에서 파일 참조용)
    - 데이터 타입: file_id는 문자열, file_size는 숫자
    
    기록 사항 (향후 활용):
    - 전체 응답 필드: [file_id, file_url, filename, size, upload_time]
    - 오류 응답 형식: {error: {code, message, details}}
    """
    pass
```

---

이 테스트 코드 제안 개요는 File API의 체계적인 테스트 구현을 위한 로드맵을 제공하며, Classic TDD 원칙을 준수하면서도 실제 사용자 플로우와 연계된 실용적인 테스트 설계를 지원합니다.