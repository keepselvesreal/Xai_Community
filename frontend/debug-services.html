<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë¹„ìŠ¤ API ë””ë²„ê¹…</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ì„œë¹„ìŠ¤ ëª©ë¡ API ë””ë²„ê¹…</h1>
    
    <div class="section">
        <h3>ğŸ“¡ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testServiceAPI()">ì„œë¹„ìŠ¤ ëª©ë¡ API í˜¸ì¶œ</button>
        <button onclick="testSingleService()">ê°œë³„ ì„œë¹„ìŠ¤ ì¡°íšŒ</button>
        <button onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>
    
    <div class="section">
        <h3>ğŸ“‹ API ì‘ë‹µ ë¡œê·¸</h3>
        <div id="api-logs" class="log">ì—¬ê¸°ì— API ì‘ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>
    
    <div class="section">
        <h3>ğŸ¯ ë°ì´í„° ë³€í™˜ ê²°ê³¼</h3>
        <div id="transform-logs" class="log">ì—¬ê¸°ì— ë³€í™˜ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        function log(message, target = 'api-logs') {
            const logElement = document.getElementById(target);
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('api-logs').textContent = '';
            document.getElementById('transform-logs').textContent = '';
        }
        
        async function testServiceAPI() {
            log('ğŸš€ ì„œë¹„ìŠ¤ ëª©ë¡ API í˜¸ì¶œ ì‹œì‘...');
            
            try {
                const response = await fetch(`${API_BASE}/api/posts?metadata_type=moving%20services&page=1&size=10`);
                log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                log('ğŸ“¦ ì „ì²´ ì‘ë‹µ êµ¬ì¡°:');
                log(JSON.stringify(data, null, 2));
                
                if (data.items && data.items.length > 0) {
                    log(`\\nğŸ“‹ ì´ ${data.items.length}ê°œ í•­ëª© ë°œê²¬`);
                    
                    const firstItem = data.items[0];
                    log('\\nğŸ” ì²« ë²ˆì§¸ í•­ëª© ìƒì„¸ ì •ë³´:');
                    log(`ì œëª©: ${firstItem.title}`);
                    log(`view_count: ${firstItem.view_count}`);
                    log(`comment_count: ${firstItem.comment_count}`);
                    log(`bookmark_count: ${firstItem.bookmark_count}`);
                    log(`like_count: ${firstItem.like_count}`);
                    log(`stats í•„ë“œ: ${JSON.stringify(firstItem.stats, null, 2)}`);
                    
                    // Service ë³€í™˜ ì‹œë®¬ë ˆì´ì…˜
                    simulateServiceTransform(firstItem);
                } else {
                    log('âŒ ì„œë¹„ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
            } catch (error) {
                log(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        async function testSingleService() {
            log('ğŸ¯ ê°œë³„ ì„œë¹„ìŠ¤ ì¡°íšŒ ì‹œì‘...');
            
            try {
                // ë¨¼ì € ëª©ë¡ì—ì„œ ì²« ë²ˆì§¸ ì„œë¹„ìŠ¤ ID ê°€ì ¸ì˜¤ê¸°
                const listResponse = await fetch(`${API_BASE}/api/posts?metadata_type=moving%20services&page=1&size=1`);
                const listData = await listResponse.json();
                
                if (listData.items && listData.items.length > 0) {
                    const firstService = listData.items[0];
                    const slug = firstService.slug || firstService.id;
                    
                    log(`ğŸ” ê°œë³„ ì„œë¹„ìŠ¤ ì¡°íšŒ: ${slug}`);
                    
                    const response = await fetch(`${API_BASE}/api/posts/${slug}`);
                    const data = await response.json();
                    
                    log('ğŸ“¦ ê°œë³„ ì„œë¹„ìŠ¤ ì‘ë‹µ:');
                    log(JSON.stringify(data, null, 2));
                    
                    log('\\nğŸ“Š ê°œë³„ ì„œë¹„ìŠ¤ í†µê³„ ì •ë³´:');
                    log(`view_count: ${data.view_count}`);
                    log(`comment_count: ${data.comment_count}`);
                    log(`bookmark_count: ${data.bookmark_count}`);
                    log(`stats: ${JSON.stringify(data.stats, null, 2)}`);
                    
                } else {
                    log('âŒ ì¡°íšŒí•  ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
            } catch (error) {
                log(`âŒ ê°œë³„ ì„œë¹„ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        function simulateServiceTransform(post) {
            log('\\nğŸ”„ Service ë³€í™˜ ì‹œë®¬ë ˆì´ì…˜...', 'transform-logs');
            
            // convertPostToService ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
            const service = {
                name: post.title,
                serviceStats: {},
                bookmarks: 0,
                stats: {}
            };
            
            log(`ì›ë³¸ Post ë°ì´í„°:`, 'transform-logs');
            log(`- view_count: ${post.view_count}`, 'transform-logs');
            log(`- comment_count: ${post.comment_count}`, 'transform-logs');
            log(`- bookmark_count: ${post.bookmark_count}`, 'transform-logs');
            log(`- stats: ${JSON.stringify(post.stats)}`, 'transform-logs');
            
            // í†µê³„ ë³€í™˜ ë¡œì§
            if (post.stats) {
                service.serviceStats = {
                    views: post.stats.view_count || post.view_count || 0,
                    inquiries: post.stats.comment_count || post.comment_count || 0,
                    reviews: post.stats.comment_count || post.comment_count || 0,
                    bookmarks: post.stats.bookmark_count || post.bookmark_count || 0
                };
                service.bookmarks = post.stats.bookmark_count || post.bookmark_count || 0;
                log(`\\nâœ… stats í•„ë“œ ê¸°ë°˜ ë³€í™˜:`, 'transform-logs');
            } else {
                service.serviceStats = {
                    views: post.view_count || 0,
                    inquiries: post.comment_count || 0,
                    reviews: post.comment_count || 0,
                    bookmarks: post.bookmark_count || 0
                };
                service.bookmarks = post.bookmark_count || 0;
                log(`\\nâœ… ê¸°ë³¸ í•„ë“œ ê¸°ë°˜ ë³€í™˜:`, 'transform-logs');
            }
            
            log(`ë³€í™˜ëœ serviceStats:`, 'transform-logs');
            log(JSON.stringify(service.serviceStats, null, 2), 'transform-logs');
            log(`ë³€í™˜ëœ bookmarks: ${service.bookmarks}`, 'transform-logs');
            
            // UI í‘œì‹œ ì‹œë®¬ë ˆì´ì…˜
            log(`\\nğŸ¨ UI í‘œì‹œ ì‹œë®¬ë ˆì´ì…˜:`, 'transform-logs');
            log(`ì¡°íšŒìˆ˜: ${service.serviceStats.views || service.stats?.view_count || 0}`, 'transform-logs');
            log(`ê´€ì‹¬: ${service.bookmarks || service.serviceStats.bookmarks || service.stats?.bookmark_count || 0}`, 'transform-logs');
            log(`ë¬¸ì˜: ${service.serviceStats.inquiries || 0}`, 'transform-logs');
            log(`í›„ê¸°: ${service.serviceStats.reviews || service.stats?.comment_count || 0}`, 'transform-logs');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            log('ğŸ”§ ì„œë¹„ìŠ¤ API ë””ë²„ê¹… ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
            log('ğŸ“ API ë² ì´ìŠ¤ URL: ' + API_BASE);
        };
    </script>
</body>
</html>